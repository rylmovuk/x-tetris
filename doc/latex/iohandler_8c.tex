\hypertarget{iohandler_8c}{}\doxysection{iohandler.\+c File Reference}
\label{iohandler_8c}\index{iohandler.c@{iohandler.c}}
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}iohandler.\+h\char`\"{}}\newline
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{iohandler_8c_aa15b9a2eaaa860e3768ad5d0c0039fea}\label{iohandler_8c_aa15b9a2eaaa860e3768ad5d0c0039fea}} 
\#define {\bfseries SCREEN\+\_\+\+LINES}~17
\item 
\mbox{\Hypertarget{iohandler_8c_abdf2b1b03f57eaac22b4192ec57c4738}\label{iohandler_8c_abdf2b1b03f57eaac22b4192ec57c4738}} 
\#define {\bfseries SCREEN\+\_\+\+COLUMNS\+\_\+1P}~54
\item 
\mbox{\Hypertarget{iohandler_8c_a777340ef44f6fe8e820665679a6cf20c}\label{iohandler_8c_a777340ef44f6fe8e820665679a6cf20c}} 
\#define {\bfseries SCREEN\+\_\+\+COLUMNS\+\_\+2P}~78
\item 
\mbox{\Hypertarget{iohandler_8c_aa204ec58d846f2354e6bd239460db89f}\label{iohandler_8c_aa204ec58d846f2354e6bd239460db89f}} 
\#define {\bfseries MSG\+\_\+\+LENGTH}~25
\item 
\mbox{\Hypertarget{iohandler_8c_a61f53234ff661840649407b5b815e423}\label{iohandler_8c_a61f53234ff661840649407b5b815e423}} 
\#define {\bfseries INPUT\+\_\+\+BUF\+\_\+\+LEN}~32
\item 
\mbox{\Hypertarget{iohandler_8c_af4d1b8a2912354646c74cf36c69f8223}\label{iohandler_8c_af4d1b8a2912354646c74cf36c69f8223}} 
\#define {\bfseries KEY\+\_\+\+LEFT}~\textquotesingle{}h\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a004194639b9ad76cea01d9e93716d4d6}\label{iohandler_8c_a004194639b9ad76cea01d9e93716d4d6}} 
\#define {\bfseries KEY\+\_\+\+RIGHT}~\textquotesingle{}l\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a7f10af6283ef3db5b0a76573f13273c7}\label{iohandler_8c_a7f10af6283ef3db5b0a76573f13273c7}} 
\#define {\bfseries KEY\+\_\+\+DROP}~\textquotesingle{}j\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a8b6b2509168f6d327345f863e261ac76}\label{iohandler_8c_a8b6b2509168f6d327345f863e261ac76}} 
\#define {\bfseries KEY\+\_\+\+ROTATE}~\textquotesingle{}r\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a31ae832a3de882f92710ed9cb0b46e0a}\label{iohandler_8c_a31ae832a3de882f92710ed9cb0b46e0a}} 
\#define {\bfseries KEY\+\_\+I}~\textquotesingle{}i\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_adb39050b8845e8b16f503a747e196749}\label{iohandler_8c_adb39050b8845e8b16f503a747e196749}} 
\#define {\bfseries KEY\+\_\+T}~\textquotesingle{}t\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a5e90bac1d19a8a6b8bc79be340470271}\label{iohandler_8c_a5e90bac1d19a8a6b8bc79be340470271}} 
\#define {\bfseries KEY\+\_\+J}~\textquotesingle{}j\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a600bb1ce7eb7b6ca4dcbb41546c32ec5}\label{iohandler_8c_a600bb1ce7eb7b6ca4dcbb41546c32ec5}} 
\#define {\bfseries KEY\+\_\+L}~\textquotesingle{}l\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a6f09e2899747f5db41369ce1dae11ebd}\label{iohandler_8c_a6f09e2899747f5db41369ce1dae11ebd}} 
\#define {\bfseries KEY\+\_\+S}~\textquotesingle{}s\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a7c655f9f55336c6db42503e356028f4d}\label{iohandler_8c_a7c655f9f55336c6db42503e356028f4d}} 
\#define {\bfseries KEY\+\_\+Z}~\textquotesingle{}z\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_adc0df72b7f6cbb006adeabff653ebeac}\label{iohandler_8c_adc0df72b7f6cbb006adeabff653ebeac}} 
\#define {\bfseries KEY\+\_\+O}~\textquotesingle{}o\textquotesingle{}
\item 
\mbox{\Hypertarget{iohandler_8c_a776c7cbc4c27d94b189abf23a2042bf4}\label{iohandler_8c_a776c7cbc4c27d94b189abf23a2042bf4}} 
\#define {\bfseries CHARUPPER}(c)~((c) -\/ \textquotesingle{}a\textquotesingle{} + \textquotesingle{}A\textquotesingle{})
\item 
\mbox{\Hypertarget{iohandler_8c_a28ae7dbb347f869b0ad144a0c72d53c8}\label{iohandler_8c_a28ae7dbb347f869b0ad144a0c72d53c8}} 
\#define {\bfseries STR\+\_\+\+EXPAND}(a)~\#a
\item 
\mbox{\Hypertarget{iohandler_8c_a51840e7e288c8d25587ce062de9d9515}\label{iohandler_8c_a51840e7e288c8d25587ce062de9d9515}} 
\#define {\bfseries STRINGIFY}(a)~STR\+\_\+\+EXPAND(a)
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Updatable\+\_\+field} \{ \newline
{\bfseries fld\+\_\+playing\+\_\+field1}
, {\bfseries fld\+\_\+playing\+\_\+field2}
, {\bfseries fld\+\_\+mid\+\_\+score}
, {\bfseries fld\+\_\+p1\+\_\+score}
, \newline
{\bfseries fld\+\_\+p2\+\_\+score}
, {\bfseries fld\+\_\+message\+\_\+bubble}
, {\bfseries fld\+\_\+count\+\_\+i}
, {\bfseries fld\+\_\+count\+\_\+t}
, \newline
{\bfseries fld\+\_\+count\+\_\+j}
, {\bfseries fld\+\_\+count\+\_\+l}
, {\bfseries fld\+\_\+count\+\_\+s}
, {\bfseries fld\+\_\+count\+\_\+z}
, \newline
{\bfseries fld\+\_\+count\+\_\+o}
, {\bfseries fld\+\_\+key\+\_\+i}
, {\bfseries fld\+\_\+key\+\_\+t}
, {\bfseries fld\+\_\+key\+\_\+j}
, \newline
{\bfseries fld\+\_\+key\+\_\+l}
, {\bfseries fld\+\_\+key\+\_\+s}
, {\bfseries fld\+\_\+key\+\_\+z}
, {\bfseries fld\+\_\+key\+\_\+o}
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$ \mbox{\hyperlink{iohandler_8c_a4439919e3e5da577126633f26ef18e1e}{iohandler\+\_\+create}} (int multiplayer)
\item 
void \mbox{\hyperlink{iohandler_8c_ae945c0ac6a7616d7661f8e00ca851957}{iohandler\+\_\+destroy}} (\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$ioh)
\item 
void \mbox{\hyperlink{iohandler_8c_ade2c9e00cb912434cf154e0d6d6ec8df}{update\+\_\+screen\+\_\+2p}} (char $\ast$$\ast$scr, \mbox{\hyperlink{struct_game}{Game}} const $\ast$game)
\item 
void \mbox{\hyperlink{iohandler_8c_a1b78aa859fc210ec5f29c6bce98cc9a5}{iohandler\+\_\+draw\+\_\+and\+\_\+read}} (\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$ioh, \mbox{\hyperlink{struct_game}{Game}} const $\ast$game)
\item 
enum \mbox{\hyperlink{tetris_8h_a80edd34c3b94a368ca215539076f733c}{Game\+\_\+action}} \mbox{\hyperlink{iohandler_8c_aba6ecb3983b2a99483364faffd8e8284}{iohandler\+\_\+next\+\_\+action\+\_\+1p}} (\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$ioh, \mbox{\hyperlink{struct_game}{Game}} const $\ast$game)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyAuthor}{Author}
Maksim Kovalkov 
\end{DoxyAuthor}


\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{iohandler_8c_a48fef6d13231adf54d427fb68d981f49}\label{iohandler_8c_a48fef6d13231adf54d427fb68d981f49}} 
\index{iohandler.c@{iohandler.c}!Updatable\_field@{Updatable\_field}}
\index{Updatable\_field@{Updatable\_field}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{Updatable\_field}{Updatable\_field}}
{\footnotesize\ttfamily enum Updatable\+\_\+field}


\begin{DoxyCode}{0}
\DoxyCodeLine{94                      \{}
\DoxyCodeLine{95     fld\_playing\_field1,}
\DoxyCodeLine{96     fld\_playing\_field2,}
\DoxyCodeLine{97     fld\_mid\_score,}
\DoxyCodeLine{98     fld\_p1\_score,}
\DoxyCodeLine{99     fld\_p2\_score,}
\DoxyCodeLine{100     fld\_message\_bubble,}
\DoxyCodeLine{101     fld\_count\_i,}
\DoxyCodeLine{102     fld\_count\_t,}
\DoxyCodeLine{103     fld\_count\_j,}
\DoxyCodeLine{104     fld\_count\_l,}
\DoxyCodeLine{105     fld\_count\_s,}
\DoxyCodeLine{106     fld\_count\_z,}
\DoxyCodeLine{107     fld\_count\_o,}
\DoxyCodeLine{108     fld\_key\_i,}
\DoxyCodeLine{109     fld\_key\_t,}
\DoxyCodeLine{110     fld\_key\_j,}
\DoxyCodeLine{111     fld\_key\_l,}
\DoxyCodeLine{112     fld\_key\_s,}
\DoxyCodeLine{113     fld\_key\_z,}
\DoxyCodeLine{114     fld\_key\_o}
\DoxyCodeLine{115 \};}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{iohandler_8c_a4439919e3e5da577126633f26ef18e1e}\label{iohandler_8c_a4439919e3e5da577126633f26ef18e1e}} 
\index{iohandler.c@{iohandler.c}!iohandler\_create@{iohandler\_create}}
\index{iohandler\_create@{iohandler\_create}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{iohandler\_create()}{iohandler\_create()}}
{\footnotesize\ttfamily \mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$ iohandler\+\_\+create (\begin{DoxyParamCaption}\item[{int}]{multiplayer }\end{DoxyParamCaption})}

Allocate and initialize an \mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}}. Exits on failure. ~\newline
 Caller owns the returned object and must call {\ttfamily iohandler\+\_\+destroy} to correctly clean up. ~\newline
 \begin{DoxyReturn}{Returns}
a pointer to a valid instance of \mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}}. 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{144 \{}
\DoxyCodeLine{145     \textcolor{keywordtype}{int} i, scr\_cols;}
\DoxyCodeLine{146 }
\DoxyCodeLine{147     \mbox{\hyperlink{struct_io__handler}{Io\_handler}} *ioh = \mbox{\hyperlink{util_8c_ae6019b6343c07934f27a553cdb12e437}{malloc\_or\_die}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_io__handler}{Io\_handler}}));}
\DoxyCodeLine{148 }
\DoxyCodeLine{149     scr\_cols = multiplayer ? SCREEN\_COLUMNS\_2P : SCREEN\_COLUMNS\_1P;}
\DoxyCodeLine{150     ioh-\/>screen = \mbox{\hyperlink{util_8c_ae98d933ff052c21025d879dddf5d60be}{alloc\_many\_or\_die}}(SCREEN\_LINES, scr\_cols);}
\DoxyCodeLine{151     \textcolor{keywordflow}{for} (i = 0; i < SCREEN\_LINES; ++i) \{}
\DoxyCodeLine{152         memcpy(ioh-\/>screen[i], screen\_init\_state[i], scr\_cols);}
\DoxyCodeLine{153         ioh-\/>screen[i][scr\_cols-\/1] = 0;}
\DoxyCodeLine{154     \}}
\DoxyCodeLine{155 }
\DoxyCodeLine{156     \textcolor{keywordflow}{if} (multiplayer) \{}
\DoxyCodeLine{157         memcpy(\&ioh-\/>screen[field\_coords[fld\_mid\_score][0]][field\_coords[fld\_mid\_score][1] -\/ 9], \textcolor{stringliteral}{"{}   scores:  "{}}, 12);}
\DoxyCodeLine{158     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{159         memset(\&ioh-\/>screen[field\_coords[fld\_p1\_score][0]][field\_coords[fld\_p1\_score][1] -\/ 4], \textcolor{charliteral}{' '}, 23);}
\DoxyCodeLine{160     \}}
\DoxyCodeLine{161 }
\DoxyCodeLine{162     ioh-\/>input\_i = 0;}
\DoxyCodeLine{163     ioh-\/>input\_buf[0] = 0;}
\DoxyCodeLine{164 }
\DoxyCodeLine{165     setvbuf(stdout, NULL, \_IOFBF, 4096);}
\DoxyCodeLine{166     \textcolor{keywordflow}{return} ioh;}
\DoxyCodeLine{167 \}}

\end{DoxyCode}
\mbox{\Hypertarget{iohandler_8c_ae945c0ac6a7616d7661f8e00ca851957}\label{iohandler_8c_ae945c0ac6a7616d7661f8e00ca851957}} 
\index{iohandler.c@{iohandler.c}!iohandler\_destroy@{iohandler\_destroy}}
\index{iohandler\_destroy@{iohandler\_destroy}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{iohandler\_destroy()}{iohandler\_destroy()}}
{\footnotesize\ttfamily void iohandler\+\_\+destroy (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$}]{ioh }\end{DoxyParamCaption})}

Deinitialize and deallocate an \mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}}, which must have been initialized by {\ttfamily iohandler\+\_\+create}. ~\newline
 
\begin{DoxyCode}{0}
\DoxyCodeLine{171 \{}
\DoxyCodeLine{172     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{173     \textcolor{keywordflow}{for} (i = 0; i < SCREEN\_LINES; ++i)}
\DoxyCodeLine{174         free(ioh-\/>screen[i]);}
\DoxyCodeLine{175     free(ioh-\/>screen);}
\DoxyCodeLine{176     }
\DoxyCodeLine{177     free(ioh);}
\DoxyCodeLine{178 \}}

\end{DoxyCode}
\mbox{\Hypertarget{iohandler_8c_a1b78aa859fc210ec5f29c6bce98cc9a5}\label{iohandler_8c_a1b78aa859fc210ec5f29c6bce98cc9a5}} 
\index{iohandler.c@{iohandler.c}!iohandler\_draw\_and\_read@{iohandler\_draw\_and\_read}}
\index{iohandler\_draw\_and\_read@{iohandler\_draw\_and\_read}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{iohandler\_draw\_and\_read()}{iohandler\_draw\_and\_read()}}
{\footnotesize\ttfamily void iohandler\+\_\+draw\+\_\+and\+\_\+read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$}]{ioh,  }\item[{\mbox{\hyperlink{struct_game}{Game}} const $\ast$}]{game }\end{DoxyParamCaption})}

Given a game state prepared for drawing, update the visual representation of the board; reset the input handler state, since inputs cannot be carried over from a previous game loop iteration. 
\begin{DoxyCode}{0}
\DoxyCodeLine{373 \{}
\DoxyCodeLine{374     \textcolor{comment}{/* Update the screen, display it, and print the prompt.  }}
\DoxyCodeLine{375 \textcolor{comment}{       Due to the "{}asyncronous"{} nature of this style of interaction, we can immediately read and store the input}}
\DoxyCodeLine{376 \textcolor{comment}{       to be processed later by the other function. */}}
\DoxyCodeLine{377     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{378 }
\DoxyCodeLine{379     \textcolor{keywordflow}{if} (game-\/>kind == Game\_kind\_Singleplayer)}
\DoxyCodeLine{380         update\_screen\_1p(ioh-\/>screen, game);}
\DoxyCodeLine{381     \textcolor{keywordflow}{else}}
\DoxyCodeLine{382         update\_screen\_2p(ioh-\/>screen, game);}
\DoxyCodeLine{383 }
\DoxyCodeLine{384     fputs(\textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n\(\backslash\)n\(\backslash\)n\(\backslash\)n"{}}, stdout);}
\DoxyCodeLine{385     \textcolor{keywordflow}{for} (i = 0; i < SCREEN\_LINES; ++i) \{}
\DoxyCodeLine{386         puts(ioh-\/>screen[i]);}
\DoxyCodeLine{387     \}}
\DoxyCodeLine{388 }
\DoxyCodeLine{389     \textcolor{keywordflow}{if} (game-\/>kind == Game\_kind\_Vs\_player)}
\DoxyCodeLine{390         fputs(game-\/>current\_player == 0 ? \textcolor{stringliteral}{"{}\#\# PLAYER 1 \#\# "{}} : \textcolor{stringliteral}{"{}\#\# PLAYER 2 \#\# "{}}, stdout);}
\DoxyCodeLine{391 }
\DoxyCodeLine{392     fputs(prompts[game-\/>state-\/1], stdout);}
\DoxyCodeLine{393     fflush(stdout);}
\DoxyCodeLine{394     ioh-\/>input\_i = 0;}
\DoxyCodeLine{395 }
\DoxyCodeLine{396     \textcolor{comment}{/*  scanf("{}\%31[\string^\(\backslash\)n]"{}, ioh-\/>input\_buf);}}
\DoxyCodeLine{397 \textcolor{comment}{        if (strlen(ioh-\/>input\_buf) != INPUT\_BUF\_LEN-\/1)}}
\DoxyCodeLine{398 \textcolor{comment}{           scanf("{}\%*[\string^\(\backslash\)n]"{});}}
\DoxyCodeLine{399 \textcolor{comment}{    */}}
\DoxyCodeLine{400     \textcolor{comment}{/* keep reading until newline but at most INPUT\_BUF\_LEN chars; throw out whatever is left */}}
\DoxyCodeLine{401     \textcolor{keywordflow}{for} (i = 0; i < INPUT\_BUF\_LEN-\/1; ++i) \{}
\DoxyCodeLine{402         \textcolor{keywordflow}{if} ((ioh-\/>input\_buf[i] = getchar()) == \textcolor{charliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{403             \textcolor{keywordflow}{break};}
\DoxyCodeLine{404     \} }
\DoxyCodeLine{405     \textcolor{keywordflow}{if} (i == INPUT\_BUF\_LEN-\/1) \{}
\DoxyCodeLine{406         \textcolor{keywordflow}{while} (getchar() != \textcolor{charliteral}{'\(\backslash\)n'}) \textcolor{comment}{/* discard */};}
\DoxyCodeLine{407     \} }
\DoxyCodeLine{408     ioh-\/>input\_buf[i] = 0;}
\DoxyCodeLine{409 \}}

\end{DoxyCode}
\mbox{\Hypertarget{iohandler_8c_aba6ecb3983b2a99483364faffd8e8284}\label{iohandler_8c_aba6ecb3983b2a99483364faffd8e8284}} 
\index{iohandler.c@{iohandler.c}!iohandler\_next\_action\_1p@{iohandler\_next\_action\_1p}}
\index{iohandler\_next\_action\_1p@{iohandler\_next\_action\_1p}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{iohandler\_next\_action\_1p()}{iohandler\_next\_action\_1p()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tetris_8h_a80edd34c3b94a368ca215539076f733c}{Game\+\_\+action}} iohandler\+\_\+next\+\_\+action\+\_\+1p (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_io__handler}{Io\+\_\+handler}} $\ast$}]{ioh,  }\item[{\mbox{\hyperlink{struct_game}{Game}} const $\ast$}]{game }\end{DoxyParamCaption})}

Given the current game state, process one input and return a game action coherent with the game state. ~\newline
 This function is called multiple times in a single game loop iteration. It must keep yielding actions until there are any valid inputs, then return a special value {\ttfamily Game\+\_\+action\+\_\+\+Queue\+\_\+empty} to signal that there are no more actions. 
\begin{DoxyCode}{0}
\DoxyCodeLine{413 \{}
\DoxyCodeLine{414     \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{415     }
\DoxyCodeLine{416     \textcolor{keywordflow}{do} \{}
\DoxyCodeLine{417         c = ioh-\/>input\_buf[ioh-\/>input\_i++];}
\DoxyCodeLine{418     \} \textcolor{keywordflow}{while} (c == \textcolor{charliteral}{' '}); \textcolor{comment}{/* no buf overflow: will reach '\(\backslash\)0' eventually */} }
\DoxyCodeLine{419 }
\DoxyCodeLine{420     \textcolor{keywordflow}{switch} (game-\/>state) \{}
\DoxyCodeLine{421     \textcolor{keywordflow}{case} Game\_state\_Choose:}
\DoxyCodeLine{422         \textcolor{keywordflow}{switch} (c) \{}
\DoxyCodeLine{423         \textcolor{keywordflow}{case} KEY\_I: \textcolor{keywordflow}{case} CHARUPPER(KEY\_I):}
\DoxyCodeLine{424             return Game\_action\_Choose\_I;}
\DoxyCodeLine{425         \textcolor{keywordflow}{case} KEY\_T: \textcolor{keywordflow}{case} CHARUPPER(KEY\_T):}
\DoxyCodeLine{426             return Game\_action\_Choose\_T;}
\DoxyCodeLine{427         \textcolor{keywordflow}{case} KEY\_J: \textcolor{keywordflow}{case} CHARUPPER(KEY\_J):}
\DoxyCodeLine{428             return Game\_action\_Choose\_J;}
\DoxyCodeLine{429         \textcolor{keywordflow}{case} KEY\_L: \textcolor{keywordflow}{case} CHARUPPER(KEY\_L):}
\DoxyCodeLine{430             return Game\_action\_Choose\_L;}
\DoxyCodeLine{431         \textcolor{keywordflow}{case} KEY\_S: \textcolor{keywordflow}{case} CHARUPPER(KEY\_S):}
\DoxyCodeLine{432             return Game\_action\_Choose\_S;}
\DoxyCodeLine{433         \textcolor{keywordflow}{case} KEY\_Z: \textcolor{keywordflow}{case} CHARUPPER(KEY\_Z):}
\DoxyCodeLine{434             return Game\_action\_Choose\_Z;}
\DoxyCodeLine{435         \textcolor{keywordflow}{case} KEY\_O: \textcolor{keywordflow}{case} CHARUPPER(KEY\_O):}
\DoxyCodeLine{436             return Game\_action\_Choose\_O;}
\DoxyCodeLine{437         \}}
\DoxyCodeLine{438         \textcolor{keywordflow}{break};}
\DoxyCodeLine{439     \textcolor{keywordflow}{case} Game\_state\_Place:}
\DoxyCodeLine{440         \textcolor{keywordflow}{switch} (c) \{}
\DoxyCodeLine{441         \textcolor{keywordflow}{case}   KEY\_LEFT: \textcolor{keywordflow}{case}   CHARUPPER(KEY\_LEFT):}
\DoxyCodeLine{442             return Game\_action\_Left;}
\DoxyCodeLine{443         \textcolor{keywordflow}{case}  KEY\_RIGHT: \textcolor{keywordflow}{case}  CHARUPPER(KEY\_RIGHT):}
\DoxyCodeLine{444             return Game\_action\_Right;}
\DoxyCodeLine{445         \textcolor{keywordflow}{case} KEY\_ROTATE: \textcolor{keywordflow}{case} CHARUPPER(KEY\_ROTATE):}
\DoxyCodeLine{446             return Game\_action\_Rotate;}
\DoxyCodeLine{447         \textcolor{keywordflow}{case}   KEY\_DROP: \textcolor{keywordflow}{case}   CHARUPPER(KEY\_DROP):}
\DoxyCodeLine{448             return Game\_action\_Drop;}
\DoxyCodeLine{449         \}}
\DoxyCodeLine{450         \textcolor{keywordflow}{break};}
\DoxyCodeLine{451     \textcolor{keywordflow}{case} Game\_state\_Cleared:}
\DoxyCodeLine{452         \textcolor{keywordflow}{return} Game\_action\_Finish\_clearing;}
\DoxyCodeLine{453     \textcolor{keywordflow}{case} Game\_state\_Lose:}
\DoxyCodeLine{454     \textcolor{keywordflow}{case} Game\_state\_Win:}
\DoxyCodeLine{455         \textcolor{keywordflow}{break};}
\DoxyCodeLine{456     \textcolor{comment}{/* exhaustive */}}
\DoxyCodeLine{457     \}}
\DoxyCodeLine{458 }
\DoxyCodeLine{459     \textcolor{keywordflow}{return} Game\_action\_Queue\_empty;}
\DoxyCodeLine{460 \}}

\end{DoxyCode}
\mbox{\Hypertarget{iohandler_8c_ade2c9e00cb912434cf154e0d6d6ec8df}\label{iohandler_8c_ade2c9e00cb912434cf154e0d6d6ec8df}} 
\index{iohandler.c@{iohandler.c}!update\_screen\_2p@{update\_screen\_2p}}
\index{update\_screen\_2p@{update\_screen\_2p}!iohandler.c@{iohandler.c}}
\doxysubsubsection{\texorpdfstring{update\_screen\_2p()}{update\_screen\_2p()}}
{\footnotesize\ttfamily void update\+\_\+screen\+\_\+2p (\begin{DoxyParamCaption}\item[{char $\ast$$\ast$}]{scr,  }\item[{\mbox{\hyperlink{struct_game}{Game}} const $\ast$}]{game }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{269                                                \{}
\DoxyCodeLine{270     \textcolor{keywordtype}{int} line, col, i;}
\DoxyCodeLine{271     \textcolor{keywordtype}{char} buf[32];}
\DoxyCodeLine{272     \{ \textcolor{comment}{/* update both boards */}}
\DoxyCodeLine{273         \textcolor{keywordtype}{int} y, x, line2, col2;}
\DoxyCodeLine{274         line  = field\_coords[fld\_playing\_field1][0];}
\DoxyCodeLine{275         col   = field\_coords[fld\_playing\_field1][1];}
\DoxyCodeLine{276         line2 = field\_coords[fld\_playing\_field2][0];}
\DoxyCodeLine{277         col2  = field\_coords[fld\_playing\_field2][1];}
\DoxyCodeLine{278         \textcolor{keywordflow}{for} (y = 0; y < \mbox{\hyperlink{constants_8h_afdeabcf1ceb950f88253cd775bacc441}{BOARD\_ROWS}}; ++y) \{}
\DoxyCodeLine{279             \textcolor{keywordflow}{for} (x = 0; x < BOARD\_COLS; ++x) \{}
\DoxyCodeLine{280                 memcpy(}
\DoxyCodeLine{281                     \&scr[line + y][col + x*2],}
\DoxyCodeLine{282                     block\_types[game-\/>board[0][y][x]],}
\DoxyCodeLine{283                     2}
\DoxyCodeLine{284                 );}
\DoxyCodeLine{285                 memcpy(}
\DoxyCodeLine{286                     \&scr[line2 + y][col2 + x*2],}
\DoxyCodeLine{287                     block\_types[game-\/>board[1][y][x]],}
\DoxyCodeLine{288                     2}
\DoxyCodeLine{289                 );}
\DoxyCodeLine{290             \}}
\DoxyCodeLine{291         \}}
\DoxyCodeLine{292     \}}
\DoxyCodeLine{293 }
\DoxyCodeLine{294     \{ \textcolor{comment}{/* update scores */}}
\DoxyCodeLine{295         line = field\_coords[fld\_p1\_score][0];}
\DoxyCodeLine{296         col = field\_coords[fld\_p1\_score][1];}
\DoxyCodeLine{297         sprintf(buf, \textcolor{stringliteral}{"{}\%3d"{}}, game-\/>score[0]);}
\DoxyCodeLine{298         memcpy(\&scr[line][col], buf, 3);}
\DoxyCodeLine{299         line = field\_coords[fld\_p2\_score][0];}
\DoxyCodeLine{300         col = field\_coords[fld\_p2\_score][1];}
\DoxyCodeLine{301         sprintf(buf, \textcolor{stringliteral}{"{}\%3d"{}}, game-\/>score[1]);}
\DoxyCodeLine{302         memcpy(\&scr[line][col], buf, 3);}
\DoxyCodeLine{303     \}}
\DoxyCodeLine{304 }
\DoxyCodeLine{305     \{ \textcolor{comment}{/* update message */} }
\DoxyCodeLine{306         line = field\_coords[fld\_message\_bubble][0];}
\DoxyCodeLine{307         col = field\_coords[fld\_message\_bubble][1];}
\DoxyCodeLine{308         \textcolor{keywordflow}{switch} (game-\/>state) \{}
\DoxyCodeLine{309         \textcolor{keywordflow}{case} Game\_state\_Choose:}
\DoxyCodeLine{310             memcpy(\&scr[line][col],   \textcolor{stringliteral}{"{}  choose which tetrimino "{}}, MSG\_LENGTH);}
\DoxyCodeLine{311             memcpy(\&scr[line+1][col], \textcolor{stringliteral}{"{}    you want to place    "{}}, MSG\_LENGTH);}
\DoxyCodeLine{312             \textcolor{keywordflow}{break};}
\DoxyCodeLine{313         \textcolor{keywordflow}{case} Game\_state\_Place:}
\DoxyCodeLine{314             sprintf(buf, \textcolor{stringliteral}{"{}<\%c>, <\%c> move left, right"{}}, KEY\_LEFT, KEY\_RIGHT);}
\DoxyCodeLine{315             memcpy(\&scr[line][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{316             sprintf(buf, \textcolor{stringliteral}{"{}  <\%c> rotate   <\%c> drop  "{}}, KEY\_ROTATE, KEY\_DROP);}
\DoxyCodeLine{317             memcpy(\&scr[line+1][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{318             \textcolor{keywordflow}{break};}
\DoxyCodeLine{319         \textcolor{keywordflow}{case} Game\_state\_Lose:}
\DoxyCodeLine{320             sprintf(buf, \textcolor{stringliteral}{"{}   player \%c, you win!!!  "{}}, game-\/>current\_player ? \textcolor{charliteral}{'1'} : \textcolor{charliteral}{'2'});}
\DoxyCodeLine{321             memcpy(\&scr[line][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{322             sprintf(buf, \textcolor{stringliteral}{"{} P\%c is stuck... too bad! "{}}, game-\/>current\_player ? \textcolor{charliteral}{'2'} : \textcolor{charliteral}{'1'});}
\DoxyCodeLine{323             memcpy(\&scr[line+1][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{324             \textcolor{keywordflow}{break};}
\DoxyCodeLine{325         \textcolor{keywordflow}{case} Game\_state\_Win:}
\DoxyCodeLine{326             \textcolor{keywordflow}{if} (game-\/>score[0] == game-\/>score[1]) \{}
\DoxyCodeLine{327                 memcpy(\&scr[line][col], \textcolor{stringliteral}{"{}    wow!! it's a tie!    "{}}, MSG\_LENGTH);}
\DoxyCodeLine{328                 memcpy(\&scr[line+1][col], \textcolor{stringliteral}{"{} you got the same score! "{}}, MSG\_LENGTH);}
\DoxyCodeLine{329             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{330                 sprintf(buf, \textcolor{stringliteral}{"{} congrats, P\%c! you won!!!"{}}, (game-\/>score[0] > game-\/>score[1] ? \textcolor{charliteral}{'1'} : \textcolor{charliteral}{'2'}));}
\DoxyCodeLine{331                 memcpy(\&scr[line][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{332                 memcpy(\&scr[line+1][col], \textcolor{stringliteral}{"{} you got a higher score! "{}}, MSG\_LENGTH);}
\DoxyCodeLine{333             \}}
\DoxyCodeLine{334                 }
\DoxyCodeLine{335             \textcolor{keywordflow}{break};}
\DoxyCodeLine{336         \textcolor{keywordflow}{case} Game\_state\_Cleared:}
\DoxyCodeLine{337             memcpy(\&scr[line][col], cleared\_lines\_messages[game-\/>lines\_cleared-\/1], MSG\_LENGTH);}
\DoxyCodeLine{338             sprintf(}
\DoxyCodeLine{339                 buf,}
\DoxyCodeLine{340                 \textcolor{stringliteral}{"{}   you earned \%2d \%s  "{}},}
\DoxyCodeLine{341                 score\_per\_lines[game-\/>lines\_cleared-\/1],}
\DoxyCodeLine{342                 (score\_per\_lines[game-\/>lines\_cleared-\/1] == 1) ? \textcolor{stringliteral}{"{}point "{}} : \textcolor{stringliteral}{"{}points"{}}}
\DoxyCodeLine{343             );}
\DoxyCodeLine{344             memcpy(\&scr[line+1][col], buf, MSG\_LENGTH);}
\DoxyCodeLine{345             \textcolor{keywordflow}{break};}
\DoxyCodeLine{346         \}}
\DoxyCodeLine{347     \}}
\DoxyCodeLine{348 }
\DoxyCodeLine{349     \{ \textcolor{comment}{/* update piece counts */}}
\DoxyCodeLine{350         \textcolor{keywordflow}{for} (i = 0; i <= 7; ++i) \{}
\DoxyCodeLine{351             line = field\_coords[fld\_count\_i + i][0];}
\DoxyCodeLine{352             col = field\_coords[fld\_count\_i + i][1];}
\DoxyCodeLine{353             sprintf(buf, \textcolor{stringliteral}{"{}\%-\/2hu"{}}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short})game-\/>pieces\_left[i]);}
\DoxyCodeLine{354             memcpy(\&scr[line][col], buf, 2);}
\DoxyCodeLine{355         \}}
\DoxyCodeLine{356     \}}
\DoxyCodeLine{357 }
\DoxyCodeLine{358     \{ \textcolor{comment}{/* update key hints */}}
\DoxyCodeLine{359         \textcolor{keywordflow}{for} (i = 0; i < 7; ++i) \{}
\DoxyCodeLine{360             line = field\_coords[fld\_key\_i + i][0];}
\DoxyCodeLine{361             col = field\_coords[fld\_key\_i + i][1];}
\DoxyCodeLine{362             \textcolor{keywordflow}{if} (game-\/>state == Game\_state\_Choose) }
\DoxyCodeLine{363                 sprintf(buf, \textcolor{stringliteral}{"{}<\%c>"{}}, key\_hints[i]);}
\DoxyCodeLine{364             \textcolor{keywordflow}{else}}
\DoxyCodeLine{365                 buf[0] = buf[1] = buf[2] = \textcolor{charliteral}{' '};}
\DoxyCodeLine{366             memcpy(\&scr[line][col], buf, 3);}
\DoxyCodeLine{367         \}}
\DoxyCodeLine{368     \}}
\DoxyCodeLine{369 \}}

\end{DoxyCode}
