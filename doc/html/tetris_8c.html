<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>X-Tetris: tetris.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">X-Tetris
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">tetris.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="constants_8h_source.html">constants.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tetris_8h_source.html">tetris.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="iohandler_8h_source.html">iohandler.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="opponentai_8h_source.html">opponentai.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae0ee4cf3bbf2d8d59d06729e85474704"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ae0ee4cf3bbf2d8d59d06729e85474704">handle_right</a> (<a class="el" href="struct_game.html">Game</a> *)</td></tr>
<tr class="separator:ae0ee4cf3bbf2d8d59d06729e85474704"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef6fb4a9a397099e743e2d02ad86bc89"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#aef6fb4a9a397099e743e2d02ad86bc89">handle_left</a> (<a class="el" href="struct_game.html">Game</a> *)</td></tr>
<tr class="separator:aef6fb4a9a397099e743e2d02ad86bc89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8afd397b2b46d88bea1d70d4ce19aa8a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a8afd397b2b46d88bea1d70d4ce19aa8a">handle_rotate</a> (<a class="el" href="struct_game.html">Game</a> *)</td></tr>
<tr class="separator:a8afd397b2b46d88bea1d70d4ce19aa8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae257250b453150f91118a167279bc003"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ae257250b453150f91118a167279bc003">check_win_condition</a> (<a class="el" href="struct_game.html">Game</a> *)</td></tr>
<tr class="separator:ae257250b453150f91118a167279bc003"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcb0ff78400ac73fb838085e8f39b0ca"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#afcb0ff78400ac73fb838085e8f39b0ca">mark_cleared_lines</a> (<a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a>)</td></tr>
<tr class="separator:afcb0ff78400ac73fb838085e8f39b0ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae75d3468e1a3f95801dde6a7c9af0913"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ae75d3468e1a3f95801dde6a7c9af0913">remove_cleared_lines</a> (<a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a>)</td></tr>
<tr class="separator:ae75d3468e1a3f95801dde6a7c9af0913"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32143b54d758b5d338b701e10df291d5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a32143b54d758b5d338b701e10df291d5">do_game_step</a> (<a class="el" href="struct_game.html">Game</a> *, enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>)</td></tr>
<tr class="separator:a32143b54d758b5d338b701e10df291d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e97676d56787a7d95dde8fcb283442b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a1e97676d56787a7d95dde8fcb283442b">draw</a> (<a class="el" href="struct_game.html">Game</a> *, <a class="el" href="struct_io__handler.html">Io_handler</a> *)</td></tr>
<tr class="separator:a1e97676d56787a7d95dde8fcb283442b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ce611f6f97e2152a734c755fb049a3d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a1ce611f6f97e2152a734c755fb049a3d">atexit_fn</a> (void)</td></tr>
<tr class="separator:a1ce611f6f97e2152a734c755fb049a3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ce59467ff024c9dd75a1b2f4d665443"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a8ce59467ff024c9dd75a1b2f4d665443">state_place_handler</a> (<a class="el" href="struct_game.html">Game</a> *, enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>)</td></tr>
<tr class="separator:a8ce59467ff024c9dd75a1b2f4d665443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3404f337f4eeccbfd63108f78aaa30d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#aa3404f337f4eeccbfd63108f78aaa30d">state_choose_handler</a> (<a class="el" href="struct_game.html">Game</a> *, enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>)</td></tr>
<tr class="separator:aa3404f337f4eeccbfd63108f78aaa30d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95f01a4be8eeef7c25497dc69fda28c4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a95f01a4be8eeef7c25497dc69fda28c4">state_cleared_handler</a> (<a class="el" href="struct_game.html">Game</a> *)</td></tr>
<tr class="separator:a95f01a4be8eeef7c25497dc69fda28c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85e4e140999c7811b647cc0dcec90664"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a85e4e140999c7811b647cc0dcec90664">action_belongs_to_state</a> (enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>, enum <a class="el" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4">Game_state</a>)</td></tr>
<tr class="separator:a85e4e140999c7811b647cc0dcec90664"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb6cbea8b2165bba95853661cb456b30"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#aeb6cbea8b2165bba95853661cb456b30">run_menu</a> (char const *const *, int)</td></tr>
<tr class="separator:aeb6cbea8b2165bba95853661cb456b30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada8ac4e1aef2bcddf751779a6282c5e5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ada8ac4e1aef2bcddf751779a6282c5e5">game_init</a> (<a class="el" href="struct_game.html">Game</a> *, enum <a class="el" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764c">Game_kind</a>)</td></tr>
<tr class="separator:ada8ac4e1aef2bcddf751779a6282c5e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee47b0a8ef22a45aed65f6c39c60aa0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#aeee47b0a8ef22a45aed65f6c39c60aa0">game_loop</a> (<a class="el" href="struct_game.html">Game</a> *, <a class="el" href="struct_io__handler.html">Io_handler</a> *, <a class="el" href="struct_opponent__ai.html">Opponent_ai</a> *)</td></tr>
<tr class="separator:aeee47b0a8ef22a45aed65f6c39c60aa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f68ceddf81ce075c77a82fec2809857"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a4f68ceddf81ce075c77a82fec2809857">init_piece_shape</a> (<a class="el" href="struct_piece.html">Piece</a> *p)</td></tr>
<tr class="separator:a4f68ceddf81ce075c77a82fec2809857"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0278303c0ee8b4dbf6db70001c5eeac2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a0278303c0ee8b4dbf6db70001c5eeac2">rotate_shape_cw</a> (<a class="el" href="tetris_8h.html#a85f28d860df7341f9d676fb1abe8ef38">Tetrimino_shape</a> shape)</td></tr>
<tr class="separator:a0278303c0ee8b4dbf6db70001c5eeac2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63db510ab66e5f8fa3594aa1cc466bca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a> (const <a class="el" href="struct_piece.html">Piece</a> *p, <a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a> board, unsigned char type)</td></tr>
<tr class="separator:a63db510ab66e5f8fa3594aa1cc466bca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae93305c912b6fb144419f2188274e01a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a> (const <a class="el" href="struct_piece.html">Piece</a> *p, const <a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a> board)</td></tr>
<tr class="separator:ae93305c912b6fb144419f2188274e01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68a0a1695ef69fb932b71defe1775bb3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a68a0a1695ef69fb932b71defe1775bb3">drop_piece</a> (<a class="el" href="struct_piece.html">Piece</a> *piece, const <a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a> board)</td></tr>
<tr class="separator:a68a0a1695ef69fb932b71defe1775bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86e91addc3f965d33baf599e5fae4623"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a86e91addc3f965d33baf599e5fae4623">lift_piece</a> (<a class="el" href="struct_piece.html">Piece</a> *piece, const <a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a> board)</td></tr>
<tr class="separator:a86e91addc3f965d33baf599e5fae4623"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>
<tr class="separator:ae66f6b31b5ad750f1fe042a706a4e3d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8585a23c91db48b58766175c462653db"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="tetris_8h.html#a85f28d860df7341f9d676fb1abe8ef38">Tetrimino_shape</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a8585a23c91db48b58766175c462653db">tetrimino_shapes</a> []</td></tr>
<tr class="separator:a8585a23c91db48b58766175c462653db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f6033465da154e79c30327bb9c05fb8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_game.html">Game</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a1f6033465da154e79c30327bb9c05fb8">g_game</a></td></tr>
<tr class="separator:a1f6033465da154e79c30327bb9c05fb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a663deea4bbc8f529ceee01b80ed97140"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_io__handler.html">Io_handler</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a> = NULL</td></tr>
<tr class="separator:a663deea4bbc8f529ceee01b80ed97140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c529e425fd9275cf8f90157370ba5db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_opponent__ai.html">Opponent_ai</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a> = NULL</td></tr>
<tr class="separator:a8c529e425fd9275cf8f90157370ba5db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Maksim Kovalkov </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a85e4e140999c7811b647cc0dcec90664" name="a85e4e140999c7811b647cc0dcec90664"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85e4e140999c7811b647cc0dcec90664">&#9670;&nbsp;</a></span>action_belongs_to_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int action_belongs_to_state </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>&#160;</td>
          <td class="paramname"><em>act</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4">Game_state</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Check that a particular action can be executed in the given state. <br  />
 This function is just for extra peace of mind and to simplify debugging. </p>
<div class="fragment"><div class="line"><span class="lineno">  484</span>{</div>
<div class="line"><span class="lineno">  485</span>    <span class="keywordflow">return</span> ((act &amp; 0xe0) == (state &lt;&lt; 5));</div>
<div class="line"><span class="lineno">  486</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1ce611f6f97e2152a734c755fb049a3d" name="a1ce611f6f97e2152a734c755fb049a3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ce611f6f97e2152a734c755fb049a3d">&#9670;&nbsp;</a></span>atexit_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void atexit_fn </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  527</span>{</div>
<div class="line"><span class="lineno">  528</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a>)</div>
<div class="line"><span class="lineno">  529</span>        <a class="code hl_function" href="iohandler_8c.html#ae945c0ac6a7616d7661f8e00ca851957">iohandler_destroy</a>(<a class="code hl_variable" href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a>);</div>
<div class="line"><span class="lineno">  530</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a>)</div>
<div class="line"><span class="lineno">  531</span>        <a class="code hl_function" href="opponentai_8c.html#a4373b744f4c3654010158f2b2f9bae58">ai_destroy</a>(<a class="code hl_variable" href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a>);</div>
<div class="line"><span class="lineno">  532</span>}</div>
<div class="ttc" id="aiohandler_8c_html_ae945c0ac6a7616d7661f8e00ca851957"><div class="ttname"><a href="iohandler_8c.html#ae945c0ac6a7616d7661f8e00ca851957">iohandler_destroy</a></div><div class="ttdeci">void iohandler_destroy(Io_handler *ioh)</div><div class="ttdef"><b>Definition:</b> iohandler.c:170</div></div>
<div class="ttc" id="aopponentai_8c_html_a4373b744f4c3654010158f2b2f9bae58"><div class="ttname"><a href="opponentai_8c.html#a4373b744f4c3654010158f2b2f9bae58">ai_destroy</a></div><div class="ttdeci">void ai_destroy(Opponent_ai *ai)</div><div class="ttdef"><b>Definition:</b> opponentai.c:49</div></div>
<div class="ttc" id="atetris_8c_html_a663deea4bbc8f529ceee01b80ed97140"><div class="ttname"><a href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a></div><div class="ttdeci">Io_handler * g_io_handler</div><div class="ttdef"><b>Definition:</b> tetris.c:103</div></div>
<div class="ttc" id="atetris_8c_html_a8c529e425fd9275cf8f90157370ba5db"><div class="ttname"><a href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a></div><div class="ttdeci">Opponent_ai * g_opp_ai</div><div class="ttdef"><b>Definition:</b> tetris.c:104</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae257250b453150f91118a167279bc003" name="ae257250b453150f91118a167279bc003"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae257250b453150f91118a167279bc003">&#9670;&nbsp;</a></span>check_win_condition()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int check_win_condition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Check whether the player has won, i.e. has used all of their pieces. </p>
<div class="fragment"><div class="line"><span class="lineno">  300</span>{</div>
<div class="line"><span class="lineno">  301</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  302</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 7; ++i) </div>
<div class="line"><span class="lineno">  303</span>        <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">pieces_left</a>[i] != 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  304</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  305</span>}</div>
<div class="ttc" id="astruct_game_html_a85dfa288bec1b02b2aa9d2f67281b274"><div class="ttname"><a href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">Game::pieces_left</a></div><div class="ttdeci">unsigned char pieces_left[7]</div><div class="ttdef"><b>Definition:</b> tetris.h:99</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae93305c912b6fb144419f2188274e01a" name="ae93305c912b6fb144419f2188274e01a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae93305c912b6fb144419f2188274e01a">&#9670;&nbsp;</a></span>collides()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int collides </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_piece.html">Piece</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const&#160;</td>
          <td class="paramname"><em>Board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Check if the piece, when placed, would collide with existing blocks or with the outer bounds of the board. </p>
<div class="fragment"><div class="line"><span class="lineno">  159</span>{</div>
<div class="line"><span class="lineno">  160</span>    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><span class="lineno">  161</span> </div>
<div class="line"><span class="lineno">  162</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 4; ++i) {</div>
<div class="line"><span class="lineno">  163</span>        <span class="keywordflow">for</span> (j = 0; j &lt; 4; ++j) {</div>
<div class="line"><span class="lineno">  164</span>            <span class="comment">/* only looking at the coordinates of actual blocks that form the piece */</span></div>
<div class="line"><span class="lineno">  165</span>            <span class="keywordflow">if</span> (!p-&gt;<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>[i][j]) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  166</span>            <span class="comment">/* if the block collides with the outside frame */</span></div>
<div class="line"><span class="lineno">  167</span>            <span class="keywordflow">if</span> (p-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> + i &lt; 0 || p-&gt;y + i &gt;= <a class="code hl_define" href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a></div>
<div class="line"><span class="lineno">  168</span>             || p-&gt;<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + j &lt; 0 || p-&gt;x + j &gt;= <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>)</div>
<div class="line"><span class="lineno">  169</span>               <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  170</span>            <span class="comment">/* if the block collides with another block */</span></div>
<div class="line"><span class="lineno">  171</span>            <span class="keywordflow">if</span> (board[p-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> + i][p-&gt;<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + j]) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  172</span>        }</div>
<div class="line"><span class="lineno">  173</span>    }</div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  175</span>}</div>
<div class="ttc" id="aconstants_8h_html_a8d325fa33dd590065a0ddb96e687f528"><div class="ttname"><a href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a></div><div class="ttdeci">#define BOARD_COLS</div><div class="ttdef"><b>Definition:</b> constants.h:14</div></div>
<div class="ttc" id="aconstants_8h_html_afdeabcf1ceb950f88253cd775bacc441"><div class="ttname"><a href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a></div><div class="ttdeci">#define BOARD_ROWS</div><div class="ttdef"><b>Definition:</b> constants.h:13</div></div>
<div class="ttc" id="astruct_piece_html_a895b6803ce74fe8574d6168d66ac6bb5"><div class="ttname"><a href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">Piece::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> tetris.h:49</div></div>
<div class="ttc" id="astruct_piece_html_a97d61c9e42873e2274620c91178e879b"><div class="ttname"><a href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">Piece::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> tetris.h:49</div></div>
<div class="ttc" id="astruct_piece_html_ab192dd2218a56fcdea112d61113b361e"><div class="ttname"><a href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">Piece::shape</a></div><div class="ttdeci">Tetrimino_shape shape</div><div class="ttdef"><b>Definition:</b> tetris.h:50</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a32143b54d758b5d338b701e10df291d5" name="a32143b54d758b5d338b701e10df291d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32143b54d758b5d338b701e10df291d5">&#9670;&nbsp;</a></span>do_game_step()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int do_game_step </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>&#160;</td>
          <td class="paramname"><em>act</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Given one of the game actions as received from IO, advances the game state as needed. Assumes the action given is coherent with the game state (the IO handler must ensure that!). The return value determines whether other actions can be chained after the current one. </p><dl class="section return"><dt>Returns</dt><dd>1 if the function can be called again in the same game loop iteration, otherwise 0. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  455</span>{</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">if</span> (act == <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca8ba58b6e78047deb62d70fee26bc2cd5">Game_action_Queue_empty</a>)</div>
<div class="line"><span class="lineno">  457</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>    assert(<a class="code hl_function" href="tetris_8c.html#a85e4e140999c7811b647cc0dcec90664">action_belongs_to_state</a>(act, game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a>));</div>
<div class="line"><span class="lineno">  460</span> </div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">switch</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a>) {</div>
<div class="line"><span class="lineno">  462</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d">Game_state_Choose</a>:</div>
<div class="line"><span class="lineno">  463</span>        <a class="code hl_function" href="tetris_8c.html#aa3404f337f4eeccbfd63108f78aaa30d">state_choose_handler</a>(game, act);</div>
<div class="line"><span class="lineno">  464</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  465</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4">Game_state_Place</a>:</div>
<div class="line"><span class="lineno">  466</span>        <a class="code hl_function" href="tetris_8c.html#a8ce59467ff024c9dd75a1b2f4d665443">state_place_handler</a>(game, act);</div>
<div class="line"><span class="lineno">  467</span>        <span class="comment">/* can chain move&amp;rotate actions; have to pause for the drop action */</span></div>
<div class="line"><span class="lineno">  468</span>        <span class="keywordflow">return</span> act != <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733cafa56237e3cbc90921481b92be7c31133">Game_action_Drop</a>;</div>
<div class="line"><span class="lineno">  469</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4691cb43ffabf1ee61b3bebbaae1ec46">Game_state_Cleared</a>:</div>
<div class="line"><span class="lineno">  470</span>        <a class="code hl_function" href="tetris_8c.html#a95f01a4be8eeef7c25497dc69fda28c4">state_cleared_handler</a>(game);</div>
<div class="line"><span class="lineno">  471</span>        <span class="comment">/* fallthrough */</span></div>
<div class="line"><span class="lineno">  472</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543">Game_state_Lose</a>:</div>
<div class="line"><span class="lineno">  473</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2">Game_state_Win</a>:</div>
<div class="line"><span class="lineno">  474</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  475</span>    }</div>
<div class="line"><span class="lineno">  476</span>}</div>
<div class="ttc" id="astruct_game_html_a8165c9a2aeda9216b6a42822ec94695c"><div class="ttname"><a href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">Game::state</a></div><div class="ttdeci">enum Game_state state</div><div class="ttdef"><b>Definition:</b> tetris.h:91</div></div>
<div class="ttc" id="atetris_8c_html_a85e4e140999c7811b647cc0dcec90664"><div class="ttname"><a href="tetris_8c.html#a85e4e140999c7811b647cc0dcec90664">action_belongs_to_state</a></div><div class="ttdeci">static int action_belongs_to_state(enum Game_action, enum Game_state)</div><div class="ttdef"><b>Definition:</b> tetris.c:483</div></div>
<div class="ttc" id="atetris_8c_html_a8ce59467ff024c9dd75a1b2f4d665443"><div class="ttname"><a href="tetris_8c.html#a8ce59467ff024c9dd75a1b2f4d665443">state_place_handler</a></div><div class="ttdeci">static void state_place_handler(Game *, enum Game_action)</div><div class="ttdef"><b>Definition:</b> tetris.c:344</div></div>
<div class="ttc" id="atetris_8c_html_a95f01a4be8eeef7c25497dc69fda28c4"><div class="ttname"><a href="tetris_8c.html#a95f01a4be8eeef7c25497dc69fda28c4">state_cleared_handler</a></div><div class="ttdeci">static void state_cleared_handler(Game *)</div><div class="ttdef"><b>Definition:</b> tetris.c:422</div></div>
<div class="ttc" id="atetris_8c_html_aa3404f337f4eeccbfd63108f78aaa30d"><div class="ttname"><a href="tetris_8c.html#aa3404f337f4eeccbfd63108f78aaa30d">state_choose_handler</a></div><div class="ttdeci">static void state_choose_handler(Game *, enum Game_action)</div><div class="ttdef"><b>Definition:</b> tetris.c:379</div></div>
<div class="ttc" id="atetris_8h_html_a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2"><div class="ttname"><a href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2">Game_state_Win</a></div><div class="ttdeci">@ Game_state_Win</div><div class="ttdef"><b>Definition:</b> tetris.h:63</div></div>
<div class="ttc" id="atetris_8h_html_a33e243da48884e73997b5c5fa62864d4a4691cb43ffabf1ee61b3bebbaae1ec46"><div class="ttname"><a href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4691cb43ffabf1ee61b3bebbaae1ec46">Game_state_Cleared</a></div><div class="ttdeci">@ Game_state_Cleared</div><div class="ttdef"><b>Definition:</b> tetris.h:66</div></div>
<div class="ttc" id="atetris_8h_html_a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d"><div class="ttname"><a href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d">Game_state_Choose</a></div><div class="ttdeci">@ Game_state_Choose</div><div class="ttdef"><b>Definition:</b> tetris.h:58</div></div>
<div class="ttc" id="atetris_8h_html_a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4"><div class="ttname"><a href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4">Game_state_Place</a></div><div class="ttdeci">@ Game_state_Place</div><div class="ttdef"><b>Definition:</b> tetris.h:60</div></div>
<div class="ttc" id="atetris_8h_html_a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543"><div class="ttname"><a href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543">Game_state_Lose</a></div><div class="ttdeci">@ Game_state_Lose</div><div class="ttdef"><b>Definition:</b> tetris.h:62</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733ca8ba58b6e78047deb62d70fee26bc2cd5"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca8ba58b6e78047deb62d70fee26bc2cd5">Game_action_Queue_empty</a></div><div class="ttdeci">@ Game_action_Queue_empty</div><div class="ttdef"><b>Definition:</b> tetris.h:112</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733cafa56237e3cbc90921481b92be7c31133"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733cafa56237e3cbc90921481b92be7c31133">Game_action_Drop</a></div><div class="ttdeci">@ Game_action_Drop</div><div class="ttdef"><b>Definition:</b> tetris.h:125</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e97676d56787a7d95dde8fcb283442b" name="a1e97676d56787a7d95dde8fcb283442b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e97676d56787a7d95dde8fcb283442b">&#9670;&nbsp;</a></span>draw()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void draw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_io__handler.html">Io_handler</a> *&#160;</td>
          <td class="paramname"><em>io_handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Prepare the game state for drawing (possibly breaking invariants assumed elsewhere in the game logic!), send the state to the I/O function for display, then restore everything to its original value. </p>
<div class="fragment"><div class="line"><span class="lineno">  313</span>{</div>
<div class="line"><span class="lineno">  314</span>    <a class="code hl_struct" href="struct_piece.html">Piece</a> ghost;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="comment">/* prepare board state */</span></div>
<div class="line"><span class="lineno">  317</span>    <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> == <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4">Game_state_Place</a>) {</div>
<div class="line"><span class="lineno">  318</span>        memcpy(&amp;ghost, &amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, <span class="keyword">sizeof</span> ghost);</div>
<div class="line"><span class="lineno">  319</span>        <a class="code hl_function" href="tetris_8c.html#a68a0a1695ef69fb932b71defe1775bb3">drop_piece</a>(&amp;ghost, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  320</span>        <span class="keywordflow">if</span> (ghost.<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> - game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> &gt;= 3)</div>
<div class="line"><span class="lineno">  321</span>            <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a4dc3b1f70e7db766658f73be20c6506f">type</a>);</div>
<div class="line"><span class="lineno">  322</span>        <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;ghost, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a2213d9bd6d67d80014cf8d88532379e8">Block_type_Ghost</a>);</div>
<div class="line"><span class="lineno">  323</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> == <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543">Game_state_Lose</a>) {</div>
<div class="line"><span class="lineno">  324</span>        <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a03362100e003766141e31ae583548ef4">Block_type_Badbk</a>);</div>
<div class="line"><span class="lineno">  325</span>    }</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    <a class="code hl_function" href="iohandler_8c.html#a1b78aa859fc210ec5f29c6bce98cc9a5">iohandler_draw_and_read</a>(io_handler, game);</div>
<div class="line"><span class="lineno">  328</span> </div>
<div class="line"><span class="lineno">  329</span>    <span class="comment">/* done drawing */</span></div>
<div class="line"><span class="lineno">  330</span>    fflush(stdout);</div>
<div class="line"><span class="lineno">  331</span> </div>
<div class="line"><span class="lineno">  332</span>    <span class="comment">/* clean up board state */</span></div>
<div class="line"><span class="lineno">  333</span>    <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> == <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4">Game_state_Place</a>) {</div>
<div class="line"><span class="lineno">  334</span>        <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0">Block_type_Empty</a>);</div>
<div class="line"><span class="lineno">  335</span>        <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;ghost, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0">Block_type_Empty</a>);</div>
<div class="line"><span class="lineno">  336</span>    }</div>
<div class="line"><span class="lineno">  337</span>}</div>
<div class="ttc" id="aiohandler_8c_html_a1b78aa859fc210ec5f29c6bce98cc9a5"><div class="ttname"><a href="iohandler_8c.html#a1b78aa859fc210ec5f29c6bce98cc9a5">iohandler_draw_and_read</a></div><div class="ttdeci">void iohandler_draw_and_read(Io_handler *ioh, Game const *game)</div><div class="ttdef"><b>Definition:</b> iohandler.c:372</div></div>
<div class="ttc" id="astruct_game_html_a1d19d73044280572c8b0f0ba8f777440"><div class="ttname"><a href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">Game::active_piece</a></div><div class="ttdeci">Piece active_piece</div><div class="ttdef"><b>Definition:</b> tetris.h:95</div></div>
<div class="ttc" id="astruct_game_html_a8955f2f33c1b953e025ddd8ba55103b7"><div class="ttname"><a href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">Game::board</a></div><div class="ttdeci">Board board[2]</div><div class="ttdef"><b>Definition:</b> tetris.h:93</div></div>
<div class="ttc" id="astruct_game_html_a9e8725fd8b83dbd424f3e60a3dee2864"><div class="ttname"><a href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">Game::current_player</a></div><div class="ttdeci">int current_player</div><div class="ttdef"><b>Definition:</b> tetris.h:103</div></div>
<div class="ttc" id="astruct_piece_html"><div class="ttname"><a href="struct_piece.html">Piece</a></div><div class="ttdef"><b>Definition:</b> tetris.h:47</div></div>
<div class="ttc" id="astruct_piece_html_a4dc3b1f70e7db766658f73be20c6506f"><div class="ttname"><a href="struct_piece.html#a4dc3b1f70e7db766658f73be20c6506f">Piece::type</a></div><div class="ttdeci">unsigned char type</div><div class="ttdef"><b>Definition:</b> tetris.h:48</div></div>
<div class="ttc" id="atetris_8c_html_a63db510ab66e5f8fa3594aa1cc466bca"><div class="ttname"><a href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a></div><div class="ttdeci">void place_piece(const Piece *p, Board board, unsigned char type)</div><div class="ttdef"><b>Definition:</b> tetris.c:146</div></div>
<div class="ttc" id="atetris_8c_html_a68a0a1695ef69fb932b71defe1775bb3"><div class="ttname"><a href="tetris_8c.html#a68a0a1695ef69fb932b71defe1775bb3">drop_piece</a></div><div class="ttdeci">void drop_piece(Piece *piece, const Board board)</div><div class="ttdef"><b>Definition:</b> tetris.c:178</div></div>
<div class="ttc" id="atetris_8h_html_ac17ac97b3c3034af945d92e30cde90e4a03362100e003766141e31ae583548ef4"><div class="ttname"><a href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a03362100e003766141e31ae583548ef4">Block_type_Badbk</a></div><div class="ttdeci">@ Block_type_Badbk</div><div class="ttdef"><b>Definition:</b> tetris.h:34</div></div>
<div class="ttc" id="atetris_8h_html_ac17ac97b3c3034af945d92e30cde90e4a2213d9bd6d67d80014cf8d88532379e8"><div class="ttname"><a href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a2213d9bd6d67d80014cf8d88532379e8">Block_type_Ghost</a></div><div class="ttdeci">@ Block_type_Ghost</div><div class="ttdef"><b>Definition:</b> tetris.h:32</div></div>
<div class="ttc" id="atetris_8h_html_ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0"><div class="ttname"><a href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0">Block_type_Empty</a></div><div class="ttdeci">@ Block_type_Empty</div><div class="ttdef"><b>Definition:</b> tetris.h:30</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68a0a1695ef69fb932b71defe1775bb3" name="a68a0a1695ef69fb932b71defe1775bb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68a0a1695ef69fb932b71defe1775bb3">&#9670;&nbsp;</a></span>drop_piece()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void drop_piece </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_piece.html">Piece</a> *&#160;</td>
          <td class="paramname"><em>piece</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const&#160;</td>
          <td class="paramname"><em>Board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Drop the piece, in the conventional Tetris sense. More precisely, this means keeping its x value, and setting its y value to put it as low as possible on the board without colliding with other pieces. </p>
<div class="fragment"><div class="line"><span class="lineno">  179</span>{</div>
<div class="line"><span class="lineno">  180</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  181</span>        ++piece-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a>;</div>
<div class="line"><span class="lineno">  182</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(piece, board)) {</div>
<div class="line"><span class="lineno">  183</span>            --piece-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a>;</div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  185</span>        }</div>
<div class="line"><span class="lineno">  186</span>    }</div>
<div class="line"><span class="lineno">  187</span>}</div>
<div class="ttc" id="atetris_8c_html_ae93305c912b6fb144419f2188274e01a"><div class="ttname"><a href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a></div><div class="ttdeci">int collides(const Piece *p, const Board board)</div><div class="ttdef"><b>Definition:</b> tetris.c:158</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ada8ac4e1aef2bcddf751779a6282c5e5" name="ada8ac4e1aef2bcddf751779a6282c5e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada8ac4e1aef2bcddf751779a6282c5e5">&#9670;&nbsp;</a></span>game_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void game_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764c">Game_kind</a>&#160;</td>
          <td class="paramname"><em>kind</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Set the game state to the initial configuration. </p>
<div class="fragment"><div class="line"><span class="lineno">  513</span>{</div>
<div class="line"><span class="lineno">  514</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d">Game_state_Choose</a>;</div>
<div class="line"><span class="lineno">  515</span>    memset(game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>, 0, <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a> * <a class="code hl_define" href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a> * 2);</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>    <span class="comment">/* game-&gt;active_piece = uninitialized  -- chosen later */</span></div>
<div class="line"><span class="lineno">  518</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a> = 0;</div>
<div class="line"><span class="lineno">  519</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a2f323963a7ce257605465ceee93585c1">score</a>[0] = game-&gt;<a class="code hl_variable" href="struct_game.html#a2f323963a7ce257605465ceee93585c1">score</a>[1] = 0;</div>
<div class="line"><span class="lineno">  520</span>    memset(game-&gt;<a class="code hl_variable" href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">pieces_left</a>, <a class="code hl_define" href="constants_8h.html#a6f5ad3a2f5f969a84aa3a46f60ef231d">STARTING_PIECES</a> * (kind == <a class="code hl_enumvalue" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca60235b105a82c5e77974efee640c7160">Game_kind_Singleplayer</a> ? 1 : 2), <span class="keyword">sizeof</span> game-&gt;<a class="code hl_variable" href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">pieces_left</a>);</div>
<div class="line"><span class="lineno">  521</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a> = 0;</div>
<div class="line"><span class="lineno">  522</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#af36ebcac0bb468b054623db998b355db">kind</a> = kind;</div>
<div class="line"><span class="lineno">  523</span>}</div>
<div class="ttc" id="aconstants_8h_html_a6f5ad3a2f5f969a84aa3a46f60ef231d"><div class="ttname"><a href="constants_8h.html#a6f5ad3a2f5f969a84aa3a46f60ef231d">STARTING_PIECES</a></div><div class="ttdeci">#define STARTING_PIECES</div><div class="ttdef"><b>Definition:</b> constants.h:15</div></div>
<div class="ttc" id="astruct_game_html_a2f323963a7ce257605465ceee93585c1"><div class="ttname"><a href="struct_game.html#a2f323963a7ce257605465ceee93585c1">Game::score</a></div><div class="ttdeci">int score[2]</div><div class="ttdef"><b>Definition:</b> tetris.h:97</div></div>
<div class="ttc" id="astruct_game_html_af36ebcac0bb468b054623db998b355db"><div class="ttname"><a href="struct_game.html#af36ebcac0bb468b054623db998b355db">Game::kind</a></div><div class="ttdeci">enum Game_kind kind</div><div class="ttdef"><b>Definition:</b> tetris.h:90</div></div>
<div class="ttc" id="astruct_game_html_afeb5745072b6665b23e64a94aae2a4a2"><div class="ttname"><a href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">Game::lines_cleared</a></div><div class="ttdeci">int lines_cleared</div><div class="ttdef"><b>Definition:</b> tetris.h:101</div></div>
<div class="ttc" id="atetris_8h_html_abb3bdc682854082cbc8eb050784e764ca60235b105a82c5e77974efee640c7160"><div class="ttname"><a href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca60235b105a82c5e77974efee640c7160">Game_kind_Singleplayer</a></div><div class="ttdeci">@ Game_kind_Singleplayer</div><div class="ttdef"><b>Definition:</b> tetris.h:71</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeee47b0a8ef22a45aed65f6c39c60aa0" name="aeee47b0a8ef22a45aed65f6c39c60aa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee47b0a8ef22a45aed65f6c39c60aa0">&#9670;&nbsp;</a></span>game_loop()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void game_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_io__handler.html">Io_handler</a> *&#160;</td>
          <td class="paramname"><em>io_handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_opponent__ai.html">Opponent_ai</a> *&#160;</td>
          <td class="paramname"><em>opp_ai</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Run the game: keep executing the game loop until the game ends. </p>
<div class="fragment"><div class="line"><span class="lineno">  493</span>{</div>
<div class="line"><span class="lineno">  494</span>    <span class="comment">/* draw, then handle as many actions as we can */</span></div>
<div class="line"><span class="lineno">  495</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  496</span>        <a class="code hl_function" href="tetris_8c.html#a1e97676d56787a7d95dde8fcb283442b">draw</a>(game, io_handler);</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>        <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> == <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2">Game_state_Win</a> || game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> == <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543">Game_state_Lose</a>)</div>
<div class="line"><span class="lineno">  499</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  500</span> </div>
<div class="line"><span class="lineno">  501</span>        <span class="keywordflow">while</span> (<a class="code hl_function" href="tetris_8c.html#a32143b54d758b5d338b701e10df291d5">do_game_step</a>(game, <a class="code hl_function" href="iohandler_8c.html#aba6ecb3983b2a99483364faffd8e8284">iohandler_next_action_1p</a>(io_handler, game))) <span class="comment">/* nop */</span>;</div>
<div class="line"><span class="lineno">  502</span> </div>
<div class="line"><span class="lineno">  503</span>        <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#af36ebcac0bb468b054623db998b355db">kind</a> == <a class="code hl_enumvalue" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca77efbdfbda479f73dffea6fd26b3c806">Game_kind_Vs_ai</a> &amp;&amp; game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a> == 1)</div>
<div class="line"><span class="lineno">  504</span>            <span class="keywordflow">while</span> (<a class="code hl_function" href="tetris_8c.html#a32143b54d758b5d338b701e10df291d5">do_game_step</a>(game, <a class="code hl_function" href="opponentai_8c.html#add24b9f8bb71dd140652b2e85e9ac68f">ai_next_action</a>(opp_ai, game))) <span class="comment">/* nop */</span>;</div>
<div class="line"><span class="lineno">  505</span>    }</div>
<div class="line"><span class="lineno">  506</span>}</div>
<div class="ttc" id="aiohandler_8c_html_aba6ecb3983b2a99483364faffd8e8284"><div class="ttname"><a href="iohandler_8c.html#aba6ecb3983b2a99483364faffd8e8284">iohandler_next_action_1p</a></div><div class="ttdeci">enum Game_action iohandler_next_action_1p(Io_handler *ioh, Game const *game)</div><div class="ttdef"><b>Definition:</b> iohandler.c:412</div></div>
<div class="ttc" id="aopponentai_8c_html_add24b9f8bb71dd140652b2e85e9ac68f"><div class="ttname"><a href="opponentai_8c.html#add24b9f8bb71dd140652b2e85e9ac68f">ai_next_action</a></div><div class="ttdeci">enum Game_action ai_next_action(Opponent_ai *ai, Game const *game)</div><div class="ttdef"><b>Definition:</b> opponentai.c:55</div></div>
<div class="ttc" id="atetris_8c_html_a1e97676d56787a7d95dde8fcb283442b"><div class="ttname"><a href="tetris_8c.html#a1e97676d56787a7d95dde8fcb283442b">draw</a></div><div class="ttdeci">static void draw(Game *, Io_handler *)</div><div class="ttdef"><b>Definition:</b> tetris.c:312</div></div>
<div class="ttc" id="atetris_8c_html_a32143b54d758b5d338b701e10df291d5"><div class="ttname"><a href="tetris_8c.html#a32143b54d758b5d338b701e10df291d5">do_game_step</a></div><div class="ttdeci">static int do_game_step(Game *, enum Game_action)</div><div class="ttdef"><b>Definition:</b> tetris.c:454</div></div>
<div class="ttc" id="atetris_8h_html_abb3bdc682854082cbc8eb050784e764ca77efbdfbda479f73dffea6fd26b3c806"><div class="ttname"><a href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca77efbdfbda479f73dffea6fd26b3c806">Game_kind_Vs_ai</a></div><div class="ttdeci">@ Game_kind_Vs_ai</div><div class="ttdef"><b>Definition:</b> tetris.h:73</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef6fb4a9a397099e743e2d02ad86bc89" name="aef6fb4a9a397099e743e2d02ad86bc89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef6fb4a9a397099e743e2d02ad86bc89">&#9670;&nbsp;</a></span>handle_left()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void handle_left </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Move the active piece left by one, if possible. </p>
<div class="fragment"><div class="line"><span class="lineno">  217</span>{</div>
<div class="line"><span class="lineno">  218</span>    --game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  220</span>        ++game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  221</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae0ee4cf3bbf2d8d59d06729e85474704" name="ae0ee4cf3bbf2d8d59d06729e85474704"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0ee4cf3bbf2d8d59d06729e85474704">&#9670;&nbsp;</a></span>handle_right()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void handle_right </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Move the active piece right by one, if possible. </p>
<div class="fragment"><div class="line"><span class="lineno">  206</span>{</div>
<div class="line"><span class="lineno">  207</span>    ++game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  208</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  209</span>        --game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  210</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8afd397b2b46d88bea1d70d4ce19aa8a" name="a8afd397b2b46d88bea1d70d4ce19aa8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8afd397b2b46d88bea1d70d4ce19aa8a">&#9670;&nbsp;</a></span>handle_rotate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void handle_rotate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Rotate the active piece, dealing with possible collisions. </p>
<div class="fragment"><div class="line"><span class="lineno">  228</span>{</div>
<div class="line"><span class="lineno">  229</span>    <a class="code hl_struct" href="struct_piece.html">Piece</a> rotated = game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>;</div>
<div class="line"><span class="lineno">  230</span>    <a class="code hl_function" href="tetris_8c.html#a0278303c0ee8b4dbf6db70001c5eeac2">rotate_shape_cw</a>(rotated.<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>);</div>
<div class="line"><span class="lineno">  231</span>    <a class="code hl_function" href="tetris_8c.html#a86e91addc3f965d33baf599e5fae4623">lift_piece</a>(&amp;rotated, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>    <span class="comment">/* we have to adjust the piece if the rotation brings some of its blocks out of bounds */</span></div>
<div class="line"><span class="lineno">  234</span>    <span class="keywordflow">if</span> (rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> &lt; 0)</div>
<div class="line"><span class="lineno">  235</span>        <span class="keywordflow">while</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;rotated, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]) &amp;&amp; rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + 2 &lt; <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>)</div>
<div class="line"><span class="lineno">  236</span>            ++rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + 4 &gt;= <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>)</div>
<div class="line"><span class="lineno">  238</span>        <span class="keywordflow">while</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;rotated, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]) &amp;&amp; rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + 2 &gt; 0)</div>
<div class="line"><span class="lineno">  239</span>            --rotated.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a>;</div>
<div class="line"><span class="lineno">  240</span> </div>
<div class="line"><span class="lineno">  241</span>    <span class="comment">/* if after adjustment it still collides, abort */</span></div>
<div class="line"><span class="lineno">  242</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;rotated, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  244</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a> = rotated;</div>
<div class="line"><span class="lineno">  245</span>}</div>
<div class="ttc" id="atetris_8c_html_a0278303c0ee8b4dbf6db70001c5eeac2"><div class="ttname"><a href="tetris_8c.html#a0278303c0ee8b4dbf6db70001c5eeac2">rotate_shape_cw</a></div><div class="ttdeci">void rotate_shape_cw(Tetrimino_shape shape)</div><div class="ttdef"><b>Definition:</b> tetris.c:116</div></div>
<div class="ttc" id="atetris_8c_html_a86e91addc3f965d33baf599e5fae4623"><div class="ttname"><a href="tetris_8c.html#a86e91addc3f965d33baf599e5fae4623">lift_piece</a></div><div class="ttdeci">void lift_piece(Piece *piece, const Board board)</div><div class="ttdef"><b>Definition:</b> tetris.c:190</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f68ceddf81ce075c77a82fec2809857" name="a4f68ceddf81ce075c77a82fec2809857"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f68ceddf81ce075c77a82fec2809857">&#9670;&nbsp;</a></span>init_piece_shape()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_piece_shape </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_piece.html">Piece</a> *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Convenience function to set the shape of a piece during initialization, by reading the <code>type</code> field. </p>
<div class="fragment"><div class="line"><span class="lineno">  111</span>{</div>
<div class="line"><span class="lineno">  112</span>    memcpy(&amp;p-&gt;<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>, <a class="code hl_variable" href="tetris_8c.html#a8585a23c91db48b58766175c462653db">tetrimino_shapes</a>[p-&gt;<a class="code hl_variable" href="struct_piece.html#a4dc3b1f70e7db766658f73be20c6506f">type</a>-1], <span class="keyword">sizeof</span> p-&gt;<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>);</div>
<div class="line"><span class="lineno">  113</span>}</div>
<div class="ttc" id="atetris_8c_html_a8585a23c91db48b58766175c462653db"><div class="ttname"><a href="tetris_8c.html#a8585a23c91db48b58766175c462653db">tetrimino_shapes</a></div><div class="ttdeci">static const Tetrimino_shape tetrimino_shapes[]</div><div class="ttdef"><b>Definition:</b> tetris.c:56</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86e91addc3f965d33baf599e5fae4623" name="a86e91addc3f965d33baf599e5fae4623"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86e91addc3f965d33baf599e5fae4623">&#9670;&nbsp;</a></span>lift_piece()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lift_piece </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_piece.html">Piece</a> *&#160;</td>
          <td class="paramname"><em>piece</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const&#160;</td>
          <td class="paramname"><em>Board</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Leave a piece's x value unchanged, and set its y value so that the piece is in the topmost position on the screen. </p>
<div class="fragment"><div class="line"><span class="lineno">  191</span>{</div>
<div class="line"><span class="lineno">  192</span>    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><span class="lineno">  193</span>    piece-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> = 0;</div>
<div class="line"><span class="lineno">  194</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div>
<div class="line"><span class="lineno">  195</span>        <span class="keywordflow">for</span> (j = 0; j &lt; 4; ++j)</div>
<div class="line"><span class="lineno">  196</span>            <span class="keywordflow">if</span> (piece-&gt;<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>[i][j]) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  197</span>        --piece-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a>;</div>
<div class="line"><span class="lineno">  198</span>    }</div>
<div class="line"><span class="lineno">  199</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae66f6b31b5ad750f1fe042a706a4e3d4" name="ae66f6b31b5ad750f1fe042a706a4e3d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae66f6b31b5ad750f1fe042a706a4e3d4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Main function. </p>
<div class="fragment"><div class="line"><span class="lineno">  558</span>{</div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordtype">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> menu_items[] = {</div>
<div class="line"><span class="lineno">  560</span>        <span class="stringliteral">&quot;Single player&quot;</span>,</div>
<div class="line"><span class="lineno">  561</span>        <span class="stringliteral">&quot;Multiplayer -- two players&quot;</span>,</div>
<div class="line"><span class="lineno">  562</span>        <span class="stringliteral">&quot;Multiplayer -- vs. AI&quot;</span></div>
<div class="line"><span class="lineno">  563</span>    };</div>
<div class="line"><span class="lineno">  564</span>    <span class="keywordtype">int</span> choice;</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>    puts(</div>
<div class="line"><span class="lineno">  567</span>        <span class="stringliteral">&quot; _       _____  ____ _____  ___   _   __ \n&quot;</span></div>
<div class="line"><span class="lineno">  568</span>        <span class="stringliteral">&quot;\\ \\_/ __  | |  | |_   | |  | |_) | | ( (`\n&quot;</span></div>
<div class="line"><span class="lineno">  569</span>        <span class="stringliteral">&quot;/_/ \\     |_|  |_|__  |_|  |_| \\ |_| _)_)\n&quot;</span></div>
<div class="line"><span class="lineno">  570</span>    );</div>
<div class="line"><span class="lineno">  571</span>    puts(<span class="stringliteral">&quot;Welcome! Choose a game mode:&quot;</span>);</div>
<div class="line"><span class="lineno">  572</span>    choice = <a class="code hl_function" href="tetris_8c.html#aeb6cbea8b2165bba95853661cb456b30">run_menu</a>(menu_items, 3);</div>
<div class="line"><span class="lineno">  573</span> </div>
<div class="line"><span class="lineno">  574</span>    <a class="code hl_function" href="tetris_8c.html#ada8ac4e1aef2bcddf751779a6282c5e5">game_init</a>(&amp;<a class="code hl_variable" href="tetris_8c.html#a1f6033465da154e79c30327bb9c05fb8">g_game</a>, (<span class="keyword">enum</span> <a class="code hl_enumeration" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764c">Game_kind</a>) choice);</div>
<div class="line"><span class="lineno">  575</span>    <a class="code hl_variable" href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a> = <a class="code hl_function" href="iohandler_8c.html#a4439919e3e5da577126633f26ef18e1e">iohandler_create</a>(choice != 0);</div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">if</span> (choice != 0)</div>
<div class="line"><span class="lineno">  577</span>        <a class="code hl_variable" href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a> = <a class="code hl_function" href="opponentai_8c.html#a0576dad202a49831da7b17d1b675f257">ai_create</a>();</div>
<div class="line"><span class="lineno">  578</span>    atexit(&amp;<a class="code hl_function" href="tetris_8c.html#a1ce611f6f97e2152a734c755fb049a3d">atexit_fn</a>);</div>
<div class="line"><span class="lineno">  579</span> </div>
<div class="line"><span class="lineno">  580</span>    <a class="code hl_function" href="tetris_8c.html#aeee47b0a8ef22a45aed65f6c39c60aa0">game_loop</a>(&amp;<a class="code hl_variable" href="tetris_8c.html#a1f6033465da154e79c30327bb9c05fb8">g_game</a>, <a class="code hl_variable" href="tetris_8c.html#a663deea4bbc8f529ceee01b80ed97140">g_io_handler</a>, <a class="code hl_variable" href="tetris_8c.html#a8c529e425fd9275cf8f90157370ba5db">g_opp_ai</a>);</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line"><span class="lineno">  583</span>}</div>
<div class="ttc" id="aiohandler_8c_html_a4439919e3e5da577126633f26ef18e1e"><div class="ttname"><a href="iohandler_8c.html#a4439919e3e5da577126633f26ef18e1e">iohandler_create</a></div><div class="ttdeci">Io_handler * iohandler_create(int multiplayer)</div><div class="ttdef"><b>Definition:</b> iohandler.c:143</div></div>
<div class="ttc" id="aopponentai_8c_html_a0576dad202a49831da7b17d1b675f257"><div class="ttname"><a href="opponentai_8c.html#a0576dad202a49831da7b17d1b675f257">ai_create</a></div><div class="ttdeci">Opponent_ai * ai_create()</div><div class="ttdef"><b>Definition:</b> opponentai.c:40</div></div>
<div class="ttc" id="atetris_8c_html_a1ce611f6f97e2152a734c755fb049a3d"><div class="ttname"><a href="tetris_8c.html#a1ce611f6f97e2152a734c755fb049a3d">atexit_fn</a></div><div class="ttdeci">static void atexit_fn(void)</div><div class="ttdef"><b>Definition:</b> tetris.c:526</div></div>
<div class="ttc" id="atetris_8c_html_a1f6033465da154e79c30327bb9c05fb8"><div class="ttname"><a href="tetris_8c.html#a1f6033465da154e79c30327bb9c05fb8">g_game</a></div><div class="ttdeci">Game g_game</div><div class="ttdef"><b>Definition:</b> tetris.c:102</div></div>
<div class="ttc" id="atetris_8c_html_ada8ac4e1aef2bcddf751779a6282c5e5"><div class="ttname"><a href="tetris_8c.html#ada8ac4e1aef2bcddf751779a6282c5e5">game_init</a></div><div class="ttdeci">static void game_init(Game *, enum Game_kind)</div><div class="ttdef"><b>Definition:</b> tetris.c:512</div></div>
<div class="ttc" id="atetris_8c_html_aeb6cbea8b2165bba95853661cb456b30"><div class="ttname"><a href="tetris_8c.html#aeb6cbea8b2165bba95853661cb456b30">run_menu</a></div><div class="ttdeci">static int run_menu(char const *const *, int)</div><div class="ttdef"><b>Definition:</b> tetris.c:535</div></div>
<div class="ttc" id="atetris_8c_html_aeee47b0a8ef22a45aed65f6c39c60aa0"><div class="ttname"><a href="tetris_8c.html#aeee47b0a8ef22a45aed65f6c39c60aa0">game_loop</a></div><div class="ttdeci">static void game_loop(Game *, Io_handler *, Opponent_ai *)</div><div class="ttdef"><b>Definition:</b> tetris.c:492</div></div>
<div class="ttc" id="atetris_8h_html_abb3bdc682854082cbc8eb050784e764c"><div class="ttname"><a href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764c">Game_kind</a></div><div class="ttdeci">Game_kind</div><div class="ttdef"><b>Definition:</b> tetris.h:70</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afcb0ff78400ac73fb838085e8f39b0ca" name="afcb0ff78400ac73fb838085e8f39b0ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcb0ff78400ac73fb838085e8f39b0ca">&#9670;&nbsp;</a></span>mark_cleared_lines()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int mark_cleared_lines </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a>&#160;</td>
          <td class="paramname"><em>board</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Set each full line on the game board to <code>Block_type_Clear</code>. </p><dl class="section return"><dt>Returns</dt><dd>the amount of lines to be cleared. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  253</span>{</div>
<div class="line"><span class="lineno">  254</span>    <span class="keywordtype">int</span> i, j, cleared_count = 0;</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a>; ++i) {</div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordtype">int</span> cleared = 1;</div>
<div class="line"><span class="lineno">  258</span>        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>; ++j)</div>
<div class="line"><span class="lineno">  259</span>            <span class="keywordflow">if</span> (!board[i][j]) cleared = 0;</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>        <span class="keywordflow">if</span> (cleared) {</div>
<div class="line"><span class="lineno">  262</span>            memset(board[i], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a3e705d0d8fd9bb7d0ed4eebd98dae5dc">Block_type_Clear</a>, <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>);</div>
<div class="line"><span class="lineno">  263</span>            ++cleared_count;</div>
<div class="line"><span class="lineno">  264</span>        }</div>
<div class="line"><span class="lineno">  265</span>    }</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>    <span class="keywordflow">return</span> cleared_count;</div>
<div class="line"><span class="lineno">  268</span>}</div>
<div class="ttc" id="atetris_8h_html_ac17ac97b3c3034af945d92e30cde90e4a3e705d0d8fd9bb7d0ed4eebd98dae5dc"><div class="ttname"><a href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a3e705d0d8fd9bb7d0ed4eebd98dae5dc">Block_type_Clear</a></div><div class="ttdeci">@ Block_type_Clear</div><div class="ttdef"><b>Definition:</b> tetris.h:33</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a63db510ab66e5f8fa3594aa1cc466bca" name="a63db510ab66e5f8fa3594aa1cc466bca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63db510ab66e5f8fa3594aa1cc466bca">&#9670;&nbsp;</a></span>place_piece()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void place_piece </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_piece.html">Piece</a> *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a>&#160;</td>
          <td class="paramname"><em>board</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Place a piece on the board with no "collision" checking and assuming it fits inside the bounds, setting each cell occupied by the piece to <code>type</code>. Can be used to "cut out" a piece by filling with empty space or to draw "ghost pieces". Note that x and y can actually be negative, and likewise y + 4 can be &gt;= BOARD_WIDTH. It is the caller's responsibility to ensure that no block compised by the piece ends up out of bounds &ndash; in other words, looking at piece-&gt;shape, <b>only zeroes</b> can end up outside of the board. </p>
<div class="fragment"><div class="line"><span class="lineno">  147</span>{</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordtype">int</span> i, j;</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 4; ++i) {</div>
<div class="line"><span class="lineno">  151</span>        <span class="keywordflow">for</span> (j = 0; j &lt; 4; ++j) {</div>
<div class="line"><span class="lineno">  152</span>            <span class="keywordflow">if</span> (p-&gt;<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>[i][j]) board[p-&gt;<a class="code hl_variable" href="struct_piece.html#a97d61c9e42873e2274620c91178e879b">y</a> + i][p-&gt;<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> + j] = type;</div>
<div class="line"><span class="lineno">  153</span>        }</div>
<div class="line"><span class="lineno">  154</span>    }</div>
<div class="line"><span class="lineno">  155</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae75d3468e1a3f95801dde6a7c9af0913" name="ae75d3468e1a3f95801dde6a7c9af0913"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae75d3468e1a3f95801dde6a7c9af0913">&#9670;&nbsp;</a></span>remove_cleared_lines()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void remove_cleared_lines </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tetris_8h.html#a37a6eb6da737b0484cc5c532330ef4c6">Board</a>&#160;</td>
          <td class="paramname"><em>board</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Remove every cleared line previously marked by <code>mark_cleared_lines</code> (more accurately, where at least the <em>first</em> block is set to <code>Block_type_Clear</code>). Shift everything downwards. </p>
<div class="fragment"><div class="line"><span class="lineno">  276</span>{</div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordtype">int</span> i = <a class="code hl_define" href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a> - 1;</div>
<div class="line"><span class="lineno">  278</span> </div>
<div class="line"><span class="lineno">  279</span>    <span class="keywordflow">while</span> (i &gt; 0) {</div>
<div class="line"><span class="lineno">  280</span>        <span class="keywordflow">if</span> (board[i][0] != <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a3e705d0d8fd9bb7d0ed4eebd98dae5dc">Block_type_Clear</a>) {</div>
<div class="line"><span class="lineno">  281</span>            --i;</div>
<div class="line"><span class="lineno">  282</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  283</span>        }</div>
<div class="line"><span class="lineno">  284</span>        </div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">if</span> (i != 0)</div>
<div class="line"><span class="lineno">  286</span>            <span class="comment">/* multidimensional arrays are contiguous in memory so this is valid */</span></div>
<div class="line"><span class="lineno">  287</span>            memmove(</div>
<div class="line"><span class="lineno">  288</span>                ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)board) + <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>,</div>
<div class="line"><span class="lineno">  289</span>                (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)board,</div>
<div class="line"><span class="lineno">  290</span>                i * <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a></div>
<div class="line"><span class="lineno">  291</span>            );</div>
<div class="line"><span class="lineno">  292</span>        memset(board[0], <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0">Block_type_Empty</a>, <span class="keyword">sizeof</span> board[0]);</div>
<div class="line"><span class="lineno">  293</span>    }</div>
<div class="line"><span class="lineno">  294</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0278303c0ee8b4dbf6db70001c5eeac2" name="a0278303c0ee8b4dbf6db70001c5eeac2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0278303c0ee8b4dbf6db70001c5eeac2">&#9670;&nbsp;</a></span>rotate_shape_cw()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rotate_shape_cw </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="tetris_8h.html#a85f28d860df7341f9d676fb1abe8ef38">Tetrimino_shape</a>&#160;</td>
          <td class="paramname"><em>shape</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Rotate a shape clockwise. </p>
<div class="fragment"><div class="line"><span class="lineno">  117</span>{</div>
<div class="line"><span class="lineno">  118</span>    <span class="comment">/* </span></div>
<div class="line"><span class="lineno">  119</span><span class="comment">     * Dumb but it works :P</span></div>
<div class="line"><span class="lineno">  120</span><span class="comment">     *</span></div>
<div class="line"><span class="lineno">  121</span><span class="comment">     * (0,0) (0,1) (0,2) (0,3)      (3,0) (2,0) (1,0) (0,0)</span></div>
<div class="line"><span class="lineno">  122</span><span class="comment">     * (1,0) (1,1) (1,2) (1,3)  -&gt;  (3,1) (2,1) (1,1) (0,1)</span></div>
<div class="line"><span class="lineno">  123</span><span class="comment">     * (2,0) (2,1) (2,2) (2,3)      (3,2) (2,2) (1,2) (0,2)</span></div>
<div class="line"><span class="lineno">  124</span><span class="comment">     * (3,0) (3,1) (3,2) (3,3)      (3,3) (2,3) (1,3) (0,3)</span></div>
<div class="line"><span class="lineno">  125</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> t;</div>
<div class="line"><span class="lineno">  128</span> </div>
<div class="line"><span class="lineno">  129</span>    <span class="comment">/* rotate outer ring */</span></div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {</div>
<div class="line"><span class="lineno">  131</span>        t = shape[0][i];</div>
<div class="line"><span class="lineno">  132</span>        shape[0][i] = shape[3-i][0];</div>
<div class="line"><span class="lineno">  133</span>        shape[3-i][0] = shape[3][3-i];</div>
<div class="line"><span class="lineno">  134</span>        shape[3][3-i] = shape[i][3];</div>
<div class="line"><span class="lineno">  135</span>        shape[i][3] = t;</div>
<div class="line"><span class="lineno">  136</span>    }</div>
<div class="line"><span class="lineno">  137</span>    <span class="comment">/* rotate inner ring */</span></div>
<div class="line"><span class="lineno">  138</span>    t = shape[1][1];</div>
<div class="line"><span class="lineno">  139</span>    shape[1][1] = shape[2][1];</div>
<div class="line"><span class="lineno">  140</span>    shape[2][1] = shape[2][2];</div>
<div class="line"><span class="lineno">  141</span>    shape[2][2] = shape[1][2];</div>
<div class="line"><span class="lineno">  142</span>    shape[1][2] = t;</div>
<div class="line"><span class="lineno">  143</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb6cbea8b2165bba95853661cb456b30" name="aeb6cbea8b2165bba95853661cb456b30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb6cbea8b2165bba95853661cb456b30">&#9670;&nbsp;</a></span>run_menu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int run_menu </td>
          <td>(</td>
          <td class="paramtype">char const *const *&#160;</td>
          <td class="paramname"><em>entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>entries_n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  536</span>{</div>
<div class="line"><span class="lineno">  537</span>    <span class="keywordtype">int</span> i, ans;</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  540</span>        <span class="keywordflow">for</span> (i = 0; i &lt; entries_n; ++i) {</div>
<div class="line"><span class="lineno">  541</span>            printf(<span class="stringliteral">&quot;%d.  %s\n&quot;</span>, i+1, entries[i]);</div>
<div class="line"><span class="lineno">  542</span>        }</div>
<div class="line"><span class="lineno">  543</span>        <span class="keywordflow">if</span> (1 == scanf(<span class="stringliteral">&quot;%d%*1[\n]&quot;</span>, &amp;ans)</div>
<div class="line"><span class="lineno">  544</span>            &amp;&amp; (--ans, 0 &lt;= ans &amp;&amp; ans &lt; entries_n))</div>
<div class="line"><span class="lineno">  545</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>        scanf(<span class="stringliteral">&quot;%*[^\n]%*1[\n]&quot;</span>); <span class="comment">/* discard until end of line */</span>       </div>
<div class="line"><span class="lineno">  548</span>    }</div>
<div class="line"><span class="lineno">  549</span> </div>
<div class="line"><span class="lineno">  550</span>    <span class="keywordflow">return</span> ans;</div>
<div class="line"><span class="lineno">  551</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3404f337f4eeccbfd63108f78aaa30d" name="aa3404f337f4eeccbfd63108f78aaa30d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3404f337f4eeccbfd63108f78aaa30d">&#9670;&nbsp;</a></span>state_choose_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void state_choose_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>&#160;</td>
          <td class="paramname"><em>act</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Helper to handle actions for <code>Game_state_Choose</code>. <br  />
 <code>act</code> must be an appropriate action for this state. </p>
<div class="fragment"><div class="line"><span class="lineno">  380</span>{</div>
<div class="line"><span class="lineno">  381</span>    <span class="keywordtype">int</span> <span class="keyword">const</span> center = <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a> / 2 - 2;</div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordtype">int</span> rots, i;</div>
<div class="line"><span class="lineno">  383</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> t = act - <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733caefe4fa2dd5ef7224d67766cd0352720b">Game_action_Choose_I</a> + <a class="code hl_enumvalue" href="tetris_8h.html#a6b9a263d9a0327727ed75740ef1cfd86ab3ceb8dddc210fc7ef18f02a8c354b28">Tetrimino_type_I</a>;</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">pieces_left</a>[t-1] &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  386</span>    --game-&gt;<a class="code hl_variable" href="struct_game.html#a85dfa288bec1b02b2aa9d2f67281b274">pieces_left</a>[t-1];</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a4dc3b1f70e7db766658f73be20c6506f">type</a> = t;</div>
<div class="line"><span class="lineno">  389</span>    <a class="code hl_function" href="tetris_8c.html#a4f68ceddf81ce075c77a82fec2809857">init_piece_shape</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>);</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>    <span class="comment">/* we must place the piece, but there might be little space, so we try every trick to make it fit; even</span></div>
<div class="line"><span class="lineno">  392</span><span class="comment">       though most of the times we will return at the earliest collision check */</span></div>
<div class="line"><span class="lineno">  393</span>    <span class="comment">/* assume we are successful */</span></div>
<div class="line"><span class="lineno">  394</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a74a1c24f0ebabe958057024772257ef4">Game_state_Place</a>;</div>
<div class="line"><span class="lineno">  395</span>    <span class="keywordflow">for</span> (rots = 0; rots &lt; 4; ++rots) {</div>
<div class="line"><span class="lineno">  396</span>        game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> = center;</div>
<div class="line"><span class="lineno">  397</span>        <a class="code hl_function" href="tetris_8c.html#a86e91addc3f965d33baf599e5fae4623">lift_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  398</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  399</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  400</span>        <span class="comment">/* start moving away further from the center */</span></div>
<div class="line"><span class="lineno">  401</span>        <span class="keywordflow">for</span> (i = 1; i &lt; 5; ++i) {</div>
<div class="line"><span class="lineno">  402</span>            game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> = center + i;</div>
<div class="line"><span class="lineno">  403</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  404</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  405</span>            game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> = center - i;</div>
<div class="line"><span class="lineno">  406</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="tetris_8c.html#ae93305c912b6fb144419f2188274e01a">collides</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]))</div>
<div class="line"><span class="lineno">  407</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  408</span>        }</div>
<div class="line"><span class="lineno">  409</span>        <span class="comment">/* try another rotation */</span></div>
<div class="line"><span class="lineno">  410</span>        <a class="code hl_function" href="tetris_8c.html#a0278303c0ee8b4dbf6db70001c5eeac2">rotate_shape_cw</a>(game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#ab192dd2218a56fcdea112d61113b361e">shape</a>);</div>
<div class="line"><span class="lineno">  411</span>    }</div>
<div class="line"><span class="lineno">  412</span>    <span class="comment">/* nope, we tried our best, but we can&#39;t place it */</span></div>
<div class="line"><span class="lineno">  413</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a895b6803ce74fe8574d6168d66ac6bb5">x</a> = center;</div>
<div class="line"><span class="lineno">  414</span>    <a class="code hl_function" href="tetris_8c.html#a86e91addc3f965d33baf599e5fae4623">lift_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  415</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a999c805b6310beb226e37a03fcaad543">Game_state_Lose</a>;</div>
<div class="line"><span class="lineno">  416</span>}</div>
<div class="ttc" id="atetris_8c_html_a4f68ceddf81ce075c77a82fec2809857"><div class="ttname"><a href="tetris_8c.html#a4f68ceddf81ce075c77a82fec2809857">init_piece_shape</a></div><div class="ttdeci">void init_piece_shape(Piece *p)</div><div class="ttdef"><b>Definition:</b> tetris.c:110</div></div>
<div class="ttc" id="atetris_8h_html_a6b9a263d9a0327727ed75740ef1cfd86ab3ceb8dddc210fc7ef18f02a8c354b28"><div class="ttname"><a href="tetris_8h.html#a6b9a263d9a0327727ed75740ef1cfd86ab3ceb8dddc210fc7ef18f02a8c354b28">Tetrimino_type_I</a></div><div class="ttdeci">@ Tetrimino_type_I</div><div class="ttdef"><b>Definition:</b> tetris.h:16</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733caefe4fa2dd5ef7224d67766cd0352720b"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733caefe4fa2dd5ef7224d67766cd0352720b">Game_action_Choose_I</a></div><div class="ttdeci">@ Game_action_Choose_I</div><div class="ttdef"><b>Definition:</b> tetris.h:114</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a95f01a4be8eeef7c25497dc69fda28c4" name="a95f01a4be8eeef7c25497dc69fda28c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95f01a4be8eeef7c25497dc69fda28c4">&#9670;&nbsp;</a></span>state_cleared_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void state_cleared_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Helper to transition from the intermediate state when some lines have just been cleared. </p>
<div class="fragment"><div class="line"><span class="lineno">  423</span>{</div>
<div class="line"><span class="lineno">  424</span>    <a class="code hl_function" href="tetris_8c.html#ae75d3468e1a3f95801dde6a7c9af0913">remove_cleared_lines</a>(game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  425</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a2f323963a7ce257605465ceee93585c1">score</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>] += <a class="code hl_variable" href="constants_8h.html#a5b29921eac7e38ec603d1b4d5c101c70">score_per_lines</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a> - 1];</div>
<div class="line"><span class="lineno">  426</span>    <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#af36ebcac0bb468b054623db998b355db">kind</a> != <a class="code hl_enumvalue" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca60235b105a82c5e77974efee640c7160">Game_kind_Singleplayer</a>) {</div>
<div class="line"><span class="lineno">  427</span>        game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a> = !game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>;</div>
<div class="line"><span class="lineno">  428</span>        <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a> &gt;= 3) {</div>
<div class="line"><span class="lineno">  429</span>            <span class="comment">/* bonus for clearing many lines: do the other player dirty :P */</span></div>
<div class="line"><span class="lineno">  430</span>            <span class="keywordtype">int</span> i, j;</div>
<div class="line"><span class="lineno">  431</span>            <span class="keywordflow">for</span> (i = 0; i &lt; game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a>; ++i) {</div>
<div class="line"><span class="lineno">  432</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> row = game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>][<a class="code hl_define" href="constants_8h.html#afdeabcf1ceb950f88253cd775bacc441">BOARD_ROWS</a>-1-i];</div>
<div class="line"><span class="lineno">  433</span>                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code hl_define" href="constants_8h.html#a8d325fa33dd590065a0ddb96e687f528">BOARD_COLS</a>; ++j) {</div>
<div class="line"><span class="lineno">  434</span>                    <span class="keywordflow">if</span> (row[j]) </div>
<div class="line"><span class="lineno">  435</span>                        row[j] = <a class="code hl_enumvalue" href="tetris_8h.html#ac17ac97b3c3034af945d92e30cde90e4a4dcfcb5b3a5780ac8849159ba91c58f0">Block_type_Empty</a>;</div>
<div class="line"><span class="lineno">  436</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  437</span>                        row[j] = <a class="code hl_enumvalue" href="tetris_8h.html#a6b9a263d9a0327727ed75740ef1cfd86ab3ceb8dddc210fc7ef18f02a8c354b28">Tetrimino_type_I</a> + (rand() % 7);</div>
<div class="line"><span class="lineno">  438</span>                }</div>
<div class="line"><span class="lineno">  439</span>            }</div>
<div class="line"><span class="lineno">  440</span>        }</div>
<div class="line"><span class="lineno">  441</span>    }</div>
<div class="line"><span class="lineno">  442</span> </div>
<div class="line"><span class="lineno">  443</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a> = 0;</div>
<div class="line"><span class="lineno">  444</span>    game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_function" href="tetris_8c.html#ae257250b453150f91118a167279bc003">check_win_condition</a>(game) ? <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2">Game_state_Win</a> : <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d">Game_state_Choose</a>;</div>
<div class="line"><span class="lineno">  445</span>}</div>
<div class="ttc" id="aconstants_8h_html_a5b29921eac7e38ec603d1b4d5c101c70"><div class="ttname"><a href="constants_8h.html#a5b29921eac7e38ec603d1b4d5c101c70">score_per_lines</a></div><div class="ttdeci">static const int score_per_lines[]</div><div class="ttdef"><b>Definition:</b> constants.h:20</div></div>
<div class="ttc" id="atetris_8c_html_ae257250b453150f91118a167279bc003"><div class="ttname"><a href="tetris_8c.html#ae257250b453150f91118a167279bc003">check_win_condition</a></div><div class="ttdeci">static int check_win_condition(Game *)</div><div class="ttdef"><b>Definition:</b> tetris.c:299</div></div>
<div class="ttc" id="atetris_8c_html_ae75d3468e1a3f95801dde6a7c9af0913"><div class="ttname"><a href="tetris_8c.html#ae75d3468e1a3f95801dde6a7c9af0913">remove_cleared_lines</a></div><div class="ttdeci">static void remove_cleared_lines(Board)</div><div class="ttdef"><b>Definition:</b> tetris.c:275</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8ce59467ff024c9dd75a1b2f4d665443" name="a8ce59467ff024c9dd75a1b2f4d665443"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ce59467ff024c9dd75a1b2f4d665443">&#9670;&nbsp;</a></span>state_place_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void state_place_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_game.html">Game</a> *&#160;</td>
          <td class="paramname"><em>game</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733c">Game_action</a>&#160;</td>
          <td class="paramname"><em>act</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Helper to handle actions for <code>Game_state_Place</code>. <br  />
 <code>act</code> must be an appropriate action for this state. </p>
<div class="fragment"><div class="line"><span class="lineno">  345</span>{</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordflow">switch</span> (act) {</div>
<div class="line"><span class="lineno">  347</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca532ae02f8e848d155eaba2c12c8c02ce">Game_action_Left</a>:</div>
<div class="line"><span class="lineno">  348</span>        <a class="code hl_function" href="tetris_8c.html#aef6fb4a9a397099e743e2d02ad86bc89">handle_left</a>(game);</div>
<div class="line"><span class="lineno">  349</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  350</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca150b8c55fe9416f21c6feaddfad052e5">Game_action_Right</a>:</div>
<div class="line"><span class="lineno">  351</span>        <a class="code hl_function" href="tetris_8c.html#ae0ee4cf3bbf2d8d59d06729e85474704">handle_right</a>(game);</div>
<div class="line"><span class="lineno">  352</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  353</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca081418596b881277bc92f9b26b7e5ac8">Game_action_Rotate</a>:</div>
<div class="line"><span class="lineno">  354</span>        <a class="code hl_function" href="tetris_8c.html#a8afd397b2b46d88bea1d70d4ce19aa8a">handle_rotate</a>(game);</div>
<div class="line"><span class="lineno">  355</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  356</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="tetris_8h.html#a80edd34c3b94a368ca215539076f733cafa56237e3cbc90921481b92be7c31133">Game_action_Drop</a>:</div>
<div class="line"><span class="lineno">  357</span>        <a class="code hl_function" href="tetris_8c.html#a68a0a1695ef69fb932b71defe1775bb3">drop_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  358</span>        <a class="code hl_function" href="tetris_8c.html#a63db510ab66e5f8fa3594aa1cc466bca">place_piece</a>(&amp;game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>, game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>], game-&gt;<a class="code hl_variable" href="struct_game.html#a1d19d73044280572c8b0f0ba8f777440">active_piece</a>.<a class="code hl_variable" href="struct_piece.html#a4dc3b1f70e7db766658f73be20c6506f">type</a>);</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>        game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a> = <a class="code hl_function" href="tetris_8c.html#afcb0ff78400ac73fb838085e8f39b0ca">mark_cleared_lines</a>(game-&gt;<a class="code hl_variable" href="struct_game.html#a8955f2f33c1b953e025ddd8ba55103b7">board</a>[game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>]);</div>
<div class="line"><span class="lineno">  361</span>        <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#afeb5745072b6665b23e64a94aae2a4a2">lines_cleared</a>) {</div>
<div class="line"><span class="lineno">  362</span>            game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4691cb43ffabf1ee61b3bebbaae1ec46">Game_state_Cleared</a>;</div>
<div class="line"><span class="lineno">  363</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  364</span>            game-&gt;<a class="code hl_variable" href="struct_game.html#a8165c9a2aeda9216b6a42822ec94695c">state</a> = <a class="code hl_function" href="tetris_8c.html#ae257250b453150f91118a167279bc003">check_win_condition</a>(game) ? <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a16520974ae27578e3b83b411b8fd64e2">Game_state_Win</a> : <a class="code hl_enumvalue" href="tetris_8h.html#a33e243da48884e73997b5c5fa62864d4a4974dc92a2b3e3d35f57caebe64dd40d">Game_state_Choose</a>;</div>
<div class="line"><span class="lineno">  365</span>            <span class="keywordflow">if</span> (game-&gt;<a class="code hl_variable" href="struct_game.html#af36ebcac0bb468b054623db998b355db">kind</a> != <a class="code hl_enumvalue" href="tetris_8h.html#abb3bdc682854082cbc8eb050784e764ca60235b105a82c5e77974efee640c7160">Game_kind_Singleplayer</a>)</div>
<div class="line"><span class="lineno">  366</span>                game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a> = !game-&gt;<a class="code hl_variable" href="struct_game.html#a9e8725fd8b83dbd424f3e60a3dee2864">current_player</a>;</div>
<div class="line"><span class="lineno">  367</span>        }</div>
<div class="line"><span class="lineno">  368</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  369</span>    <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  370</span>    <span class="comment">/* exhaustive */</span></div>
<div class="line"><span class="lineno">  371</span>    }</div>
<div class="line"><span class="lineno">  372</span>}</div>
<div class="ttc" id="atetris_8c_html_a8afd397b2b46d88bea1d70d4ce19aa8a"><div class="ttname"><a href="tetris_8c.html#a8afd397b2b46d88bea1d70d4ce19aa8a">handle_rotate</a></div><div class="ttdeci">static void handle_rotate(Game *)</div><div class="ttdef"><b>Definition:</b> tetris.c:227</div></div>
<div class="ttc" id="atetris_8c_html_ae0ee4cf3bbf2d8d59d06729e85474704"><div class="ttname"><a href="tetris_8c.html#ae0ee4cf3bbf2d8d59d06729e85474704">handle_right</a></div><div class="ttdeci">static void handle_right(Game *)</div><div class="ttdef"><b>Definition:</b> tetris.c:205</div></div>
<div class="ttc" id="atetris_8c_html_aef6fb4a9a397099e743e2d02ad86bc89"><div class="ttname"><a href="tetris_8c.html#aef6fb4a9a397099e743e2d02ad86bc89">handle_left</a></div><div class="ttdeci">static void handle_left(Game *)</div><div class="ttdef"><b>Definition:</b> tetris.c:216</div></div>
<div class="ttc" id="atetris_8c_html_afcb0ff78400ac73fb838085e8f39b0ca"><div class="ttname"><a href="tetris_8c.html#afcb0ff78400ac73fb838085e8f39b0ca">mark_cleared_lines</a></div><div class="ttdeci">static int mark_cleared_lines(Board)</div><div class="ttdef"><b>Definition:</b> tetris.c:252</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733ca081418596b881277bc92f9b26b7e5ac8"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca081418596b881277bc92f9b26b7e5ac8">Game_action_Rotate</a></div><div class="ttdeci">@ Game_action_Rotate</div><div class="ttdef"><b>Definition:</b> tetris.h:124</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733ca150b8c55fe9416f21c6feaddfad052e5"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca150b8c55fe9416f21c6feaddfad052e5">Game_action_Right</a></div><div class="ttdeci">@ Game_action_Right</div><div class="ttdef"><b>Definition:</b> tetris.h:123</div></div>
<div class="ttc" id="atetris_8h_html_a80edd34c3b94a368ca215539076f733ca532ae02f8e848d155eaba2c12c8c02ce"><div class="ttname"><a href="tetris_8h.html#a80edd34c3b94a368ca215539076f733ca532ae02f8e848d155eaba2c12c8c02ce">Game_action_Left</a></div><div class="ttdeci">@ Game_action_Left</div><div class="ttdef"><b>Definition:</b> tetris.h:122</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1f6033465da154e79c30327bb9c05fb8" name="a1f6033465da154e79c30327bb9c05fb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f6033465da154e79c30327bb9c05fb8">&#9670;&nbsp;</a></span>g_game</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_game.html">Game</a> g_game</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a663deea4bbc8f529ceee01b80ed97140" name="a663deea4bbc8f529ceee01b80ed97140"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a663deea4bbc8f529ceee01b80ed97140">&#9670;&nbsp;</a></span>g_io_handler</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_io__handler.html">Io_handler</a>* g_io_handler = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8c529e425fd9275cf8f90157370ba5db" name="a8c529e425fd9275cf8f90157370ba5db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c529e425fd9275cf8f90157370ba5db">&#9670;&nbsp;</a></span>g_opp_ai</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_opponent__ai.html">Opponent_ai</a>* g_opp_ai = NULL</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8585a23c91db48b58766175c462653db" name="a8585a23c91db48b58766175c462653db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8585a23c91db48b58766175c462653db">&#9670;&nbsp;</a></span>tetrimino_shapes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="tetris_8h.html#a85f28d860df7341f9d676fb1abe8ef38">Tetrimino_shape</a> tetrimino_shapes[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Representation of each tetrimino (in one of the possible rotations) in a Indices are &lt;value of `enum Tetrimino_type`&gt; - 1. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
